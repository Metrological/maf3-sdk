<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-97712706-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-97712706-1")</script><meta http-equiv="x-ua-compatible" content="ie=edge"><title>MAF Documentation ðŸ“–</title><meta name="description" content="Metrological Application Framework Documentation ðŸ“–"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#ffffff"><meta name="apple-mobile-web-app-title" content="MAF Documentation ðŸ“–"><meta name="application-name" content="MAF Documentation ðŸ“–"><meta name="msapplication-TileColor" content="#5f429c"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png?2.0.0"><link rel="apple-touch-icon" sizes="180x180" href="../img/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="194x194" href="../img/favicon-194x194.png"><link rel="icon" type="image/png" sizes="192x192" href="../img/android-chrome-192x192.png"><link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png"><link rel="mask-icon" href="../img/safari-pinned-tab.svg" color="#5f429c"><link rel="shortcut icon" href="../favicon.ico"><link rel="manifest" href="/manifest.json?2.0.0"><link href="../docs.min.css" rel="stylesheet"></head><body class="clearfix navClosed getting-started actionsClosed closeFull"><section id="blur-container"><section id="container" class="noTabs"><header><div class="dropdown"><a class="metrological-logo dropdown-toggle" role="button" id="logo-dropdown" data-toggle="dropdown">Metrological <span class="metrological-logo-tv"></span> <span class="metrological-logo-text"></span> <span class="caret"></span></a><ul class="dropdown-menu" role="menu" aria-labelledby="logo-dropdown"><li role="presentation"><a role="menuitem" tabindex="-1" href="http://www.metrological.com/" target="_blank">Metrological.com</a></li><li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" tabindex="-1" href="https://dashboard.metrological.com" target="_blank">Dashboard</a></li><li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" tabindex="-1" href="https://git.io/maf3-sdk" target="_blank">GitHub</a></li><li role="presentation" class="divider"></li><li role="presentation"><a role="menuitem" tabindex="-1" href="https://metrological.atlassian.net/servicedesk/customer/portal/1" target="_blank">Support</a></li></ul></div><div class="navItems"><nav><ul><li><a class="nav-button sidepanel-toggle" onclick="toggleNav(!0)"><span class="et-icon-menu-toggle">&#9776;</span></a></li><li class="active"><a href="#introduction" title="Getting Started"><span class="et-icon-graduation-cap">&#127891;</span></a></li><li><a href="../design-guide/#guide" title="Design Guide"><span class="et-icon-brush">&#59290;</span></a></li><li><a href="../review-guidelines/#metrological-app-store-review-guidelines" title="Review Guidelines"><span class="et-icon-check">&#x2713;</span></a></li><li><a href="../api/MAF.application/" title="API"><span class="et-icon-code">&#59156;</span></a></li><li><a href="../faq/#intro" title="Frequently Asked Questions"><span class="et-icon-info-circled">&#xe705;</span></a></li><li class="external"><a href="https://dashboard.metrological.com" target="_blank" title="Dashboard"><span class="et-icon-window">&#xe74e;</span></a></li><li class="external"><a href="https://git.io/maf3-sdk" target="_blank" title="Download"><span class="et-icon-download">&#x1f4e5;</span></a></li><li class="external"><a href="https://metrological.atlassian.net/servicedesk/customer/portal/1" target="_blank" title="Support"><span class="et-icon-lifebuoy">&#xe788;</span></a></li></ul></nav><nav class="align-right"><ul><li><a id="search" title="Search"><span class="et-icon-search">&#x1f50d;</span></a></li></ul></nav></div></header><div class="content-loader"></div><div class="content-view"><article class="article-container"><section><h1 id="introduction">Getting started</h1><p>While designing your app you will have to keep in mind that you are developing for a TV platform, this means that a user sits further away from the screen than for example a tablet or computer screen. This also means that there are technical limitations such as less CPU power and less Memory. By following the MAF SDK guidelines you will have a better chance of developing a good app.</p><p>When a design and/or functional document has been made you should send it to Metrological for validation. This will help you find possible issues upfront, which will speed up your development time in the long run.Â </p><p>Metrological provides free SDK training in our Rotterdam office. During this training session we can provide insight about our SDK and the platforms that you can develop for. This will give your developers a head start and will result in both less development time and a better product in the end. If you are not able to commute to Rotterdam we can think of other solutions for doing this training.</p><p>During development, you can upload your code on our <a href="https://dashboard.metrological.com">Dashboard</a>. This allows you to test your app on the targeted platform(s). Doing this early on, you have a better idea of how your app will perform when itâ€™s finished. This also allows us to review your code, give feedback on it and assist you with the possible issues you are facing.</p><p>When the app is tested thoroughly and all found issues are fixed let us know. We will start our validation tests after this, these tests will result in either our approval or a list of bugs to fix. In most cases we will come back to you within 2 to 3 business days, with a possible extend to 2 weeks. We expect the app to pass within 3 rounds of validation.</p><p>Before you submit your app, be sure to read our <a href="../review-guidelines/#metrological-app-store-review-guidelines">review guidelines</a>.</p><p>We are always available to answer questions or give feedback in any phase of development of the app. To reach us please contact us via our <a href="https://metrological.atlassian.net/servicedesk/customer/portal/1">Helpdesk</a>. We expect to answer within 1 to 2 business days.</p></section><section><h1 id="examples">Example Apps</h1><p>On our GitHub page we have several example apps available that you can use as a reference when developing your own app. They can be found <a href="https://github.com/Metrological/maf3-sdk/tree/master/apps">here</a>.</p></section><section><h1 id="howto">How to build your first App</h1><p>This tutorial will teach you the following:</p><ul><li><p>Installing the Metrological Application Framework</p></li><li><p>Writing your first app</p></li><li><p>Submitting your app to Metrological</p></li></ul><p>And will assume the following:</p><ul><li><p>Knowledge of Javascript</p></li><li><p>Basic understanding of Object Oriented Programming</p></li></ul><p>For detailed information on any MAF3 Class, please refer to the <a href="../api/MAF.application/" target="_blank">Class Reference</a>. For detailed information on designing your apps, please refer to the <a href="../design-guide/#guide" target="_blank">Design Guide</a>.</p></section><section><h1 id="setup">Setup your work environment</h1><p>First we have to retrieve the necessary files to start developing apps from our <a href="https://github.com/Metrological/maf3-sdk" target="_blank">MAF-SDK</a> Github repository. To clone them to your machine use the following commands in your terminal:</p><pre><code class="bash">$ cd ~/To/Your/Desired/Location
$ git clone https://github.com/Metrological/maf3-sdk.git</code></pre><p>After you received the source a node server has to be started. If you haven't installed node yet please refer to <a href="http://nodejs.org/" target="_blank">nodejs.org</a> to see how to do this. After installing Node.js you can start the server by running the following commands:</p><pre><code class="bash">$ cd ./maf3-sdk
$ npm install
$ node ./sdk.js</code></pre><p>From now on you can access the server at <a href="http://localhost:8080" target="_blank">localhost:8080</a> and start developing your apps. It is also possible to start the server to a port of your choice.</p><pre><code class="bash">$ NODE_PORT=8080 node ./sdk.js</code></pre></section><section><h1 id="config">Common Configuration</h1><p>Some common configurations to verify before you start developing your first app;<ul><li>MAF Apps are created using JavaScript. We do not support newer versions of JavaScript such as ES6. Please use Standard ECMA-262 5.1 Edition also known as ES5 only.</li><li>Use UTF-8 character encoding only.</li><li>Use LF as end-of-line marker only.</li><li>Please trim trailing whitespace in your code.</li></ul>Confirming to this configuration ensures the best portability and operatability between all Setopboxes that your app might run on.</p><p>Also note that development of your app might best be done in the Chrome or Safari browsers. A lot of Setopboxes run a variety of WebKit. Therefore doing you final test/review in Safari will yield the best indication of how things might actually render and work on Setopbox.</p></section><section><h1 id="filesystem">Filesystem</h1><section><h3>First application</h3><p>At this point you are able to create your first application, but before you can start there are somethings that you need to know about the filesystem. The most important folders for you as app developer are the 'apps' and 'src' folders. The 'apps' folder contains all apps, including the app we are going to develop. The 'src' folder contains all the classes you can use for building your app. This source is open for anyone to read or to extend in your own app. Keep in mind that if you change these files the app won't work on our servers as those folders are not uploaded at the end of the proces. Therefore, please extend the classes inside your app if you want to modify them.</p><p>Now let's start with creating a folder for your app in the apps directory called 'com.CompanyName.app.AppName' with the following structure:</p><div class="text-block-content"><ul class="filelist"><li class="folder"><span class="et-icon-folder">&#128193;</span> com.CompanyName.app.AppName<ul><li class="folder"><span class="et-icon-folder">&#128193;</span> Contents<ul><li class="folder"><span class="et-icon-folder">&#128193;</span> Images</li><li class="folder"><span class="et-icon-folder">&#128193;</span> Javascript<ul><li class="folder"><span class="et-icon-folder">&#128193;</span> core</li><li class="folder"><span class="et-icon-folder">&#128193;</span> views</li><li class="file"><span class="et-icon-text-doc">&#128196;</span> init.js</li></ul></li><li class="folder"><span class="et-icon-folder">&#128193;</span> Localization<ul><li class="file"><span class="et-icon-text-doc">&#128196;</span> en-EU.strings</li></ul></li><li class="file"><span class="et-icon-text-doc">&#128196;</span> metadata.json</li></ul></li></ul></li></ul></div><p>You can copy the <a href="https://github.com/Metrological/maf3-sdk/tree/master/apps/com.metrological.app.EmptyTemplate">EmptyTemplate</a> or create one from scratch through the command line with the following lines:</p><pre><code class="bash">cd apps/com.CompanyName.app.AppName
mkdir -p Contents/Images
mkdir -p Contents/Javascript
mkdir -p Contents/Localization
touch Contents/Localization/en-EU.strings
touch Contents/Javascript/init.js
touch Contents/metadata.json</code></pre><p>The folders should be self-explanatory: the 'Images' folder contains all the images you want to use in the app, the 'Javascript' folder contains all Javascript files, in this folder we usually have two more folders to seperate views and core functionalities, called 'views' and 'core'. The folder is 'Localization' and containing all translation files used inside the app.</p><p>To start developing we have to register your app in the index.html located in the root of the maf3-sdk folder. The index.html contains an object containing various keys with value's for setting up the UI, language, plugins and of course the apps. To add your app to the index add 'com.CompanyName.app.AppName' to the apps array, like below:</p><div class="text-block-content"><pre class="javascript"><code>var MAE = {
  // ui: 'com.metrological.ui.AutoStart',
  ui: 'com.metrological.ui.Horizon',
  language: 'en',
  categories: [
    'favorites',
    'video',
    'news',
    'social',
    'games',
    'sport',
    'lifestyle'
  ],
  apps: [
    'com.metrological.app.ButtonsTemplate',
    'com.metrological.app.GridTemplate',
    'com.metrological.app.TabsTemplate',
    'com.metrological.app.RSSTemplate',
    'com.metrological.app.VideoTemplate',
    'com.CompanyName.app.AppName'
  ]
};</code></pre></div><p>As you can see there are multiple uis to choose from, selecting AutoStart ui will cause the first app in the list to boot when you open your appstore. Selecting a provider's ui will show their appstore in your browser. After you added your app to the list you need to link the indentifier of the application's folder in the metadata.json which is found in the 'Contents' folder of the application.</p></section></section><section><h1 id="metadata">Metadata</h1><section><h3>Metadata.json</h3><p>When you open the metadata.json file the following information should be there:</p><pre class="javascript"><code>{
  "identifier": "com.metrological.app.EmptyTemplate",
  "name": "Empty App Template",
  "version": "0.0.1",
  "author": "Metrological Widgets",
  "company": "Metrological Widgets",
  "copyright": "Metrological Widgets 2014",
  "description": "A clean App structure",
  "categories": [
    "video"
  ],
  "scripts": "Javascript/init.js",
  "images": {
    "about": "Images/Icon.png",
    "icon": {
      "192x192": "Images/Icon.png"
    }
  }
}
</code></pre><p>Some info regarding the keys, from top to bottom:</p><p>The <code>identifier</code> key must contain a unique identifier, this identifier must be exactly the same as the folder name of your application.</p><p>The <code>name</code> and <code>description</code> keys contain the name and description that are displayed on the UI. The description should match the App, not the channel or company it is from. It also is important to keep the descriptions as short as possible (max 100 characters), this way it will fit in the reserved spaces. Longer texts might look good in your current UI, but remember that the layout of other UIs can be completely different, so a longer text could be truncated.</p><p>The <code>version</code> key indicates the version of the application. Make sure that when you upload and submit your application that you will have to change the version number as well.</p><p>In the <code>author</code>, <code>company</code> and <code>copyright</code> keys you can add the information users get to see when they open the about view of your application.</p><p>The <code>scripts</code> key indicates which script files the browser will load when you start the application. This can be either a single string or an array.</p><p>The <code>category</code> key indicates the category section your application belongs to for example; video, news, sport, games.</p><p>The <code>images</code> key contains keys for several images used througout the application. The options you have are:</p><ul><li>header (normal and focused)</li><li>about</li><li>icon (in this sample 192x192)</li></ul><p>Please keep in mind that the header and about images are never used in a fullscreen application, in this case you are free to leave these two options out of metadata file.</p></section></section><section><h1 id="publish">Publish your App</h1><section><h3>Preparation</h3><p>In order to publish your App to one of our Stores, you will need to upload a zip file containing the app source code and all additional files. Be sure to zip the root folder of your app. So in case of <code>com.metrological.app.example</code>, zip this folder and not the <code>Contents</code> folder within it. Also make sure that none of the files you have in your zip file are larger then 5 Mb.</p><p>Before uploading, you will need to <a href="https://sso.metrological.com/#/create-account">create an account</a> on our <a href="https://dashboard.metrological.com/">Dashboard</a>. When your account is created and activated, you will be able to start uploading your app.</p><h3>Uploading</h3><p>To upload, go to the <a href="https://dashboard.metrological.com/#/applications/submit">submit</a> page. Here you can either drag and drop, or browse for you zip file containing the app. When the upload has finished, you are able to review the status of your app on the <a href="https://dashboard.metrological.com/#/applications/submit-status">submit status</a> page. If all goes well, within seconds, the status of your app will be success. Otherwise, details on the errors that occured can be retrieved from this page. In this case, you will need to make some changes and upload a new version of your app.</p><p>If your app upload has been a success, please let us know via our <a href="https://metrological.atlassian.net/servicedesk/customer/portal/1">Support Desk</a>. Submit a <a href="https://metrological.atlassian.net/servicedesk/customer/portal/1/create/10">Settopbox Remote Access</a> request if you would like to test and validate the app yourself on a Settopbox via remote connection. Alternatively, you can request us to perform a <a href="https://metrological.atlassian.net/servicedesk/customer/portal/1/create/9">Quality Assurance</a> test on your app, in order to validate the app for submission towards operators.</p></section></section><section><h1 id="navigation">Navigating your App</h1><section><h3>Navigation</h3><p>It is important to keep in mind that on a Settopbox and/or television, user do not have a mouse at their disposal. Therefore it is equally important that you do not develop and test your app using your mouse. Do use your keyboard only.</p><p>Navigation is handled by these key (combinations):<table><colgroup><col width="160"><col></colgroup><tr><th>Moving around</th><td>Directional keys</td></tr><tr><th>Stop (video)</th><td>Shift + Down</td></tr><tr><th>Play/Pause (video)</th><td>Shift + Up</td></tr><tr><th>Rewind (video)</th><td>Shift + Left</td></tr><tr><th>Forward (video)</th><td>Shift + Right</td></tr><tr><th>Back</th><td>Backspace</td></tr><tr><th>Red</th><td>F1</td></tr><tr><th>Green</th><td>F2</td></tr><tr><th>Yellow</th><td>F3</td></tr><tr><th>Blue</th><td>F4</td></tr><tr><th>Channel Up</th><td>PageUp</td></tr><tr><th>Channel Down</th><td>PageDown</td></tr></table></p></section></section><section><h1 id="sidebarFullscreen">Sidebar or Fullscreen</h1><section><h3>To sidebar or not to sidebar...</h3><p>Once you have set up your metadata.json you can start with the development of your application. The layout of your application depends on which kind of content you will be showing. For contextual or quick look applications for example; social media, and news we recommend using the sidebar view. For applications which require a custom environment to create a better user experience we recommend using the fullscreen view. You can find the proper dimensions for each specific view in the <a href="../design-guide/#sidebar" target="_blank">design guide</a>.</p><p>In this example we will make use of the sidebar view. To create a new view you need to make a new file in the 'Javascript/views' folder, as this view will be our main view we'll call it 'MainView.js'. The view class has to look like this:</p><div class="text-block-content"><pre class="javascript"><code>var MainView = new MAF.Class( {
  ClassName: 'MainView',
  Extends: MAF.system.SidebarView,

  initialize: function() {
    this.parent();
  },

  createView: function() {},

  updateView: function() {}
} );</code></pre></div><p>The next step is to register your newly created view to your application. This is done by using the init.js file, this files is usually placed in the <code>Javascript</code> folder of your application. This file should look as followed:</p><div class="text-block-content"><pre class="javascript"><code>include('Javascript/views/MainView.js');

MAF.application.init( {
  views: [
    { id: 'view-MainView', viewClass: MainView },
    { id: 'view-About', viewClass: MAF.views.AboutBox },
  ],
  defaultViewId: 'view-MainView',
  settingsViewId: 'view-About'
} );</code></pre></div><p>At the top of the init.js you can load files with <code>include</code> function, with a parameter which defines the path to the source code. Each view has to be added to the views array. Each view contains a <code>id</code> which is used as an identifier that you have to use to load that specific view, and a <code>viewClass</code> is the class of that view. The <code>defaultViewId</code> defines which view will load first, and which view to load when you press the home button at the top of the screen. The <code>settingsViewId</code> defines which view will load when you press the info button at the bottom of the screen, in our case you can use the default about view from the framework, this will show the information you entered in the metadata file.</p><p>When you have your metadata, main view, and init.js file setup you should be able to start your application through one of the user interfaces.</p></section></section><section><h1 id="helloWorld">Hello World</h1><section><h3>Filling the application</h3><p>At this point can see that your view is empty, what we are missing now is a header and content. Let start with adding a header image. In the metadata file you already pointed out a path to your header, but the image itself is still missing. As the <a href="../design-guide/#branding" target="_blank">Design Guide</a> suggests that the banner has to be something related to the application itself. The icon for you application has to be set in the same way, refer to the <a href="../design-guide/#icon" target="_blank">Design Guide</a> for details for design specifications it.</p><p>Now we are going to add content to the application, you can start an element like a the text label, called with <a href="../api/MAF.element.Text/" target="_blank"><code>MAF.element.Text</code></a>.</p><pre class="javascript" data-start="10"><code>createView: function() {
  new MAF.element.Text( {
    label: $_('Hello World!'),
    styles:{
      width: this.width,
      height: this.height,
      fontSize: 60,
      anchorStyle: 'center'
    }
  } ).appendTo( this );
},</code></pre><p>With our new element you show the user a piece of text, but at this moment you have no way of changing either the label or its style. Thats why you have to alter your code.</p><pre class="javascript" data-start="10"><code>createView: function() {
  this.elements.ourText = new MAF.element.Text( {
    label: $_('Hello World!'),
    styles:{
      width: this.width,
      height: this.height,
      fontSize: 60,
      anchorStyle: 'center'
    }
  } ).appendTo( this );
},</code></pre><p>The <code>this</code> refers to the class of the view we are on. In our framework you have the possibility to add items to the <code>view.elements</code> or to the <code>view.controls</code>. The difference between the two of them is that the MAF components stored in <code>view.controls</code> can remember the state they have. So for example if you want the focus to return to the same button when you return to the view you need to create a controls component instead of an elements component. Also make sure that in these cases you add a <code>guid:</code> config value to the button and use the <code>view.controls</code> version instead of the <code>view.elements</code> one. Aside of the state there is another distinction between <code>MAF.element</code> components and <code>MAF.control</code> components. The <code>MAF.element</code> components don't have any default styling, while the <code>MAF.control</code> components do. If you want to remember the state, but dont want any default styling add <code>theme: false</code> to the config of the component.</p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body">At this point we discussed the fundamentals of using the MAF-SDK. After this point the documentation will cover various MAF components using parts of the templates included in the <a href="https://github.com/Metrological/maf3-sdk" target="_blank">MAF-SDK</a> on Github. For detailed information on components and their functions please refer to the <a href="../api/MAF.application/" target="_blank">Class Reference</a>.</div></div></section></section><section><h1 id="buttonsEvents">Buttons and Events</h1><section><h3 id="buttons">Adding a button</h3><p>Plain text can't be focused or pressed upon, so to add some interaction to your application you can add a button to change the text when the user has pressed this button. For the following article we partially use the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.ButtonsTemplate" target="_blank">ButtonsTemplate</a> found in the MAF-SDK source on Github.</p><pre class="javascript"><code>createView: function() {

    // Create a Text element with translated label
    var textButtonLabel = new MAF.element.Text( {
      label: $_('MAF.control.TextButton'),
      styles: {
        height: 40,
        width: 400,
        hOffset: ( this.width - 400 ) / 2
      }
    } ).appendTo( this );

    // Create a Text button with a select event
    var textButton = new MAF.control.TextButton( {
      label: $_('TextButton'),
      styles: {
        width: textButtonLabel.width,
        height: 60,
        hOffset: textButtonLabel.hOffset,
        vOffset: textButtonLabel.outerHeight
      },
      textStyles: { anchorStyle: 'center' },
      events: {
        onSelect: function() {
          log('onSelect function TextButton');
        }
      }
    } ).appendTo( this );
},</code></pre><p>Placing a <a href="../api/MAF.control.TextButton/" target="_blank"><code>MAF.control.TextButton</code></a> is just like placing a <a href="../api/MAF.element.Text/" target="_blank"><code>MAF.element.Text</code></a>, first we initialize it before appending it to the view. Pressing the button will cause a log in our browser's console window. This is caused by the onSelect event we added in the events of the textButton.</p><p>You may have noticed that the code shows a variable at the beginning of our <a href="../api/MAF.system.BaseView/#function_createView" target="_blank"><code>createView</code></a> function. The reason for this is because the <code>this</code> object has a different meaning for events of an element. If the log would contain both <code>view</code> and <code>this</code> you could see that <code>view</code> returns the instance of our <a href="../api/MAF.system.SidebarView/" target="_blank"><code>MAF.system.SidebarView</code></a> while this returns the instance of <a href="../api/MAF.control.TextButton/" target="_blank"><code>MAF.control.TextButton</code></a>. An alternative way is to use <a href="../api/MAF.element.Core/#function_getView" target="_blank"><code>this.getView</code></a> function to fetch the view. This only works if the button is really appended to the view or an element that is already appended to the view with the <a href="../api/MAF.control.TextButton/#function_appendTo" target="_blank"><code>appendTo</code></a> function.</p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body"><a href="../api/MAF.control.TextButton/" target="_blank"><code>MAF.control.TextButton</code></a> is only one of a few Buttons. To see more examples and workings of buttons please look in the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.ButtonsTemplate" target="_blank">ButtonsTemplate</a> found in the MAF-SDK source on Github.</div></div></section><section><h3 id="subscribeEvent">Subscribing to events</h3><p>Another way of performing actions on event is by using a listener. Listeners are called every time the event that you listen to is fired, thus able to execute your code. To listen to an event on a specific event you have to use the <a href="../api/Function/#function_subscribeTo" target="_blank"><code>subscribeTo</code></a> function. The first parameter is the <code>instance of a MAF class</code> to listen to. The second is the event to respond on, to listen to multiple events an array of strings can be used. The final parameter is the scope you can send along, if no scope parameter is added the scope is the object of the first parameter. With this way of listening it is possible to execute code on instances you didn't create yourself, for example the home button in a sidebarView. In the following example the <a href="../api/MAF.application/"><code>MAF.application</code></a> singleton is the instance to listen to.</p><pre class="javascript"><code>blockHome: function( state ) {
  if ( state )
    this._homeHandler = this.onActivateHomeButtonPress.subscribeTo( MAF.application, 'onActivateHomeButton', this );
  else
    this._homeHandler.unsubscribeFrom( MAF.application, 'onActivateHomeButton' );
},
onActivateHomeButtonPress: function( evt ) {
  //block going back to home
  evt.stop();
},</code></pre><p>To see which event can be subscribed to please refer to the <a href="../api/MAF.application/" target="_blank">Class Reference</a></p></section></section><section><h1 id="newView">Loading a new View</h1><section><h3 id="lifecycle">Application lifecycle</h3><p>While creating a new view a lot of functions are called, the following list should be used as a developing guide.</p><table><tbody><tr><th>Function Name</th><th>Called when..</th><th>What does it do..</th><th>What to place in it..</th></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_initView" target="_blank"><code>initView</code></a></td><td>Once, when view is created</td><td>Initializes the basic objects on the view</td><td>Register your global listeners and variables</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_createView" target="_blank"><code>createView</code></a></td><td>Once, when view is created</td><td>View is loaded in the <code>DOM</code> tree</td><td>Create and append most -if not all- of your elements here</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_updateView" target="_blank"><code>updateView</code></a></td><td>Everytime the user visits the view</td><td>View is visible to the user from here on</td><td>Update your elements contents if it is dynamic and place listeners that are canceled in the hideView</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_selectView" target="_blank"><code>selectView</code></a></td><td>Everytime the user visits the view</td><td>View is selected as currentview</td><td>Remembered states are restored to their elements</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_focusView" target="_blank"><code>focusView</code></a></td><td>Everytime the user visits the view</td><td>The focus on the view is placed</td><td>If you want an other focus, do so here</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_unselectView" target="_blank"><code>unselectView</code></a></td><td>Everytime the user leaves the view</td><td>The application deselects the view as it's current</td><td>Cancel listeners that are no longer necessary</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_hideView" target="_blank"><code>hideView</code></a></td><td>Everytime the user leaves the view</td><td>The view is hidden from the user</td><td>Cancel listeners that are no longer necessary</td></tr><tr><td><a href="../api/MAF.system.SidebarView/#function_destroyView" target="_blank"><code>destroyView</code></a></td><td>Once, when application is destroyed</td><td>Removes all elements on the view</td><td>If the application leaves memory leaks and/or pollution warnings in your console remove them here.</td></tr></tbody></table><p>It is important to understand that when you switch views within your app the closing functions of the old view are run after the opening functions of the new view. The following flowchart shows the order of all functions. Also note that the <code>destroy</code> functions are only called on closing the whole application. If you use <a href="../api/MAF.system.SidebarView/#function_initialize" target="_blank"><code>intialize</code></a> instead of <a href="../api/MAF.system.SidebarView/#function_initView" target="_blank"><code>initView</code></a> (like we do in the examples) you will need to include <code>this.parent();</code> function as the first line in your function, in order to call it's parent function.</p><a href="../img/flow.svg" target="_blank"><img src="../img/flow.svg" style="width:100%;background-color:#fff" alt="Application Lifecycle Flowchart"></a></section><section><h3 id="createupdate">CreateView and UpdateView function</h3><p>The <a href="../api/MAF.system.BaseView/#function_createView" target="_blank"><code>createView</code></a> and <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function are called upon the first load of the view, the <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function however will be called everytime a user visits the view whereas the <a href="../api/MAF.system.BaseView/#function_createView" target="_blank"><code>createView</code></a> function will not. The created view will stay in the DOM tree until the application is closed, while creating elements in the <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function will create duplicate elements unless they are removed somewhere else. Let's create a new view to navigate to as shown below, this time we called it <code>ElementGridView</code> and is saved in the same folder as the <code>MainView</code>.<pre class="javascript"><code>var GridView = new MAF.Class( {
  ClassName: 'ElementGridView',
  Extends: MAF.system.SidebarView,

  initialize: function() {
    this.parent();
  },

  createView: function() {},

  updateView: function() {}
} );</code></pre></p><p>Now you have to include the new view you made to the init.js file, like we did below.</p><pre class="javascript"><code>include('Javascript/views/MainView.js');
include('Javascript/views/ElementGridView.js');

MAF.application.init( {
  views: [
    { id: 'view-MainView', viewClass: MainView },
    { id: 'view-ElementGridView', viewClass: GridView },
    { id: 'view-About', viewClass: MAF.views.AboutBox }
  ],
  defaultViewId: 'view-MainView',
  settingsViewId: 'view-About'
} );</code></pre><p>To load your new view you have to make use of the <a href="../api/MAF.application/#function_loadView" target="_blank"><code>loadView</code></a> function. To demostrate this we take another button from the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.ButtonsTemplate/Contents/Javascript/Views/ExampleView1.js#L197" target="_blank">ButtonsTemplate</a>.</p><pre class="javascript"><code>var nextView = this.controls.nextView = new MAF.control.TextButton( {
  guid: 'loadExampleView2',
  label: $_('ExampleView2'),
  styles: {
    width: textButtonLabel.width,
    height: textButton.height,
    hOffset: textButtonLabel.hOffset,
    vOffset: view.height - 100
  },
  textStyles:{
    hOffset: 10
  },
  content: [
    new MAF.element.Text({
      label: FontAwesome.get('chevron-right'), // Create a FontAwesome icon
      styles: {
        height: 'inherit',
        width: 'inherit',
        hOffset: -10,
        anchorStyle: 'rightCenter'
      }
    })
  ],
  events: {
    onSelect: function () {
      // Load next Example view with data
      MAF.application.loadView('view-ExampleView2', {
        myData: [1, 2, 3]
      });
    }
  }
}).appendTo(view);</code></pre><p>The most important thing here is the <a href="../api/MAF.control.TextButton/#event_onSelect" target="_blank"><code>onSelect</code></a> event on the <a href="../api/MAF.control.TextButton/" target="_blank"><code>MAF.control.TextButton</code></a>. For this function you can add two parameters; first the id of the view you want to load, and a optional parameter which transports data from your current view to the new view you wish to load. More on this subject can be found at <a href="#passingData" target="_blank">Passing data to the next or previous view</a>. The template has the <code>'view-ExampleView2'</code> string as first parameter, but we want to change that into <code>'ElementGridView'</code> to match it with our setup.</p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body">Loading new views isn't the hardest thing to do, organising and using them in a good way is. For developers it is important to give views clear names. Dont use too many views because users will most likely get confused of all the different pages. Apps should be simple and powerful.</div></div></section></section><h1 id="grids">Grids</h1><section><h3>Setting up your grid</h3><p>For the following article we use the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.GridTemplate" target="_blank">GridTemplate</a> found in the MAF-SDK source on Github. In our ElementGridView we will place a <a href="../api/MAF.element.Grid/" target="_blank"><code>MAF.element.Grid</code></a> and assign a <a href="../api/MAF.element.Grid/#config_cellCreator" target="_blank"><code>cellCreator</code></a> and <a href="../api/MAF.element.Grid/#config_cellUpdater" target="_blank"><code>cellUpdater</code></a> function.</p><pre><code class="javascript">var ElementGridView = new MAF.Class( {
  ClassName: 'ElementGridView',
  Extends: MAF.system.SidebarView,

  createView: function() {

    var backButton = new MAF.control.BackButton( {
      label: $_('BACK')
    } ).appendTo( this );

    // In the ControlGridView.js example there is a guid, when guid is not needed
    // but the element needs to be accessed outside the create view function
    // you can reference elements in the view.elements object
    var elementGrid = this.elements.elementGrid = new MAF.element.Grid( {
      rows: 2,
      columns: 2,
      styles: {
        width: this.width,
        height: this.height - backButton.outerHeight,
        vOffset: backButton.outerHeight
      },
      cellCreator: function() {
        var cell = new MAF.element.GridCell( {
          styles: this.getCellDimensions(),
          events:{
            onSelect: function() {
              log( 'onSelect function GridCell', this.getCellIndex() );
            },
            onFocus: function() {
              var cellIndex = this.getCellIndex();

              if ( 1 === cellIndex || 2 === cellIndex ) {
                this.animate( {
                  backgroundImage: 'Images/focus.png',
                  backgroundRepeat: 'repeat-x',
                  duration: 0.3,
                  scale: 1.2
                } );
              } else {
                this.animate( {
                  backgroundColor: 'white',
                  duration: 0.3,
                  scale: 1.2
                } );

                this.title.animate( {
                  duration: 0.3,
                  color: 'black'
                } );
              }
            },
            onBlur: function () {
              var cellIndex = this.getCellIndex();

              if ( 1 === cellIndex || 2 === cellIndex ) {
                this.animate( {
                  backgroundImage: null,
                  duration: 0.3,
                  scale: 1.0
                } );
              } else {
                this.animate( {
                  backgroundColor: null,
                  duration: 0.3,
                  scale: 1.0
                } );
                this.title.animate( {
                  duration: 0.3,
                  color: 'white'
                });
              }
            }
          }
        } );

        cell.title = new MAF.element.Text( {
          styles: {
            width: cell.width,
            height: cell.height,
            color: 'white',
            fontSize: 30,
            anchorStyle: 'center',
            wrap: true
          }
        } ).appendTo( cell );

        return cell;
      },
      cellUpdater: function( cell, data ) {
        cell.title.setText( data.title );
      }
    } ).appendTo( this );
  },

  updateView: function() {
    this.elements.elementGrid.changeDataset( [
      { title: $_('Cell1') },
      { title: $_('Cell2') },
      { title: $_('Cell3') },
      { title: $_('Cell4') }
    ], true );
  }
} );</code></pre><p>The creator is the function that is called to create the necessary DOM elements. The updater is called whenever the content of the cells needs to be changed, for example loading different/new page of the grid. We will also need an <a href="../api/MAF.element.Grid/#function_changeDataset" target="_blank"><code>changeDataset</code></a> function, this will add data to your grid. The function has two parameters to pass down, the first one is to send the new data to the grid, and the second one is to reset the page of the grid. To reset the paging and go back to page 1 you have to pass <code>true</code>. If you want to stay on the current page you have to pass <code>false</code>. For now we use a static array as data to fill our grid with and reset our grid.</p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body"><a href="../api/MAF.element.Grid/" target="_blank"><code>MAF.element.Grid</code></a> has many ways to implement. To see more examples and workings of grids please look in the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.GridTemplate" target="_blank">GridTemplate</a> found in the MAF-SDK source on Github. But remember, the grid is to be used for datasets only. Not for layout purposes.</div></div></section><section><h1 id="requests">Requests</h1><section><h3 id="requestingData">Requesting data from external and local files or API's</h3><p>When creating an application which uses requests to a certain API, you need to keep in mind that there is no fixed time on how long a data delivery might take. You will also need to check if you actually received data, or if any errors have occurred. Thats where <a href="../api/Request/" target="_blank"><code>Request</code></a> comes in handy.</p><pre><code class="javascript">new Request( {
  url: 'http://cdn.metrological.com/examples/alphabet.json',
  onSuccess: function( json ) { console.log( 'succes', json ); },
  onFailure: function( failure ) { console.log( 'failure', failure ); },
  onError: function( error ) { console.log( 'error', error ); },
  onTimeout: function( message ) { console.log( 'timeout', message ); }
} ).send();</code></pre><p>This <a href="../api/Request/" target="_blank"><code>Request</code></a> has three different event functions.</p><ol><li><a href="../api/Request/#config_onSucces" target="_blank"><code>onSucces</code></a>, this function is called when the server returns state 200, after this it will send data through the chosen parameter name.</li><li><a href="../api/Request/#config_onFailure" target="_blank"><code>onFailure</code></a>, this function is called when the server returns something else than state 200.</li><li><a href="../api/Request/#config_onError" target="_blank"><code>onError</code></a>, this function is called when an error has occured during either the onSucces, or onFailure event.</li><li><a href="../api/Request/#config_onTimeout" target="_blank"><code>onTimeout</code></a>, this function is called when the request's duration exceeds the set timeout.</li></ol><p>To update your grid with a request you will have to add a <a href="../api/MAF.element.Grid/#function_changeDataset" target="_blank"><code>changeDataset</code></a> call to the <a href="../api/Request/#config_onSucces" target="_blank"><code>onSucces</code></a> event.</p><pre><code class="javascript">updateView: function() {
  var view = this;

  new Request( {
    url: 'http://cdn.metrological.com/examples/alphabet.json',
    onSuccess: function( json ) {
      view.elements.aGrid.changeDataset( json, true );
      console.log( 'success', json );
    },
    onFailure: function( error ) { console.log( 'failure', error ); },
    onError: function( error ) { console.log( 'error', error ); }
  } ).send();
} );</code></pre><h3 id="splitRequests">Split requests from views</h3><p>If your application has multiple views which all use the same request function, we recommend that you use a seperate file. Usually we call that file 'API.js' and place it in the 'Javascript/core' folder. This way you can always call the <a href="../api/Request/" target="_blank"><code>Request</code></a> on any view as long as it is within the scope of your application.</p><p>To further enhance this way of programming, we included a message system to our framework. With this message system you can store data under a given parameter, in our example we used the parameter <code>alphabet</code>, you can call upon this function using the <a href="../api/MAF.messages/#function_store" target="_blank"><code>MAF.messages.store</code> function</a>. Every time the given message changes the message system will send out a callback which will be caught by a specific function.</p><p>To visualize this way of data management we are going to look at the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.RSSTemplate" target="_blank">RSSTemplate</a></p><pre><code class="javascript">// Create a class and extended it from the MAF.system.SidebarView
var ListView = new MAF.Class( {
  Extends: MAF.system.SidebarView,
  ClassName: 'ListView',

  initView: function() {
    // Register MAF messages listener to the views dataHasChanged method.
    this.registerMessageCenterListenerCallback( this.dataHasChanged );
  },

  // Create your dataHasChanged function
  dataHasChanged: function( evt ) {
    var controls = this.controls;
    var payload  = evt.payload;

    if ( 'MyFeedData' === payload.key ) {
      if ( payload.value.length > 0 ) {
        controls.grid.changeDataset( payload.value, true );
        controls.grid.visible = true;
        controls.grid.focus();
      } else {
        controls.grid.visible = false;
      }
    }
  },

  // Create your view template
  createView: function() {

    // Create a Grid, by adding it into the view's controls object and
    // setting guid focus will be remembered when returning to the view
    var controlGrid = this.controls.grid = new MAF.control.Grid( {
      rows: 6,
      columns: 1,
      guid: 'myControlGrid',
      orientation: 'vertical',
      styles: {
        width: this.width - 20,
        height: this.height,
        visible: false
      },
      cellCreator: function() {
        // Create cells for the grid
        var cell = new MAF.control.GridCell( {
          styles: this.getCellDimensions(),
          events: {
            onSelect: function() {
              // Load the ItemView when a cell is selected
              MAF.application.loadView( 'view-ItemView', {
                item: this.getCellDataItem()
              } );
            }
          }
        } );

        cell.title = new MAF.element.Text( {
          visibleLines: 2,
          styles: {
            fontSize: 24,
            width: cell.width - 20,
            hOffset: 10,
            vOffset: 40,
            wrap: true,
            truncation: 'end'
          }
        } ).appendTo( cell );

        return cell;
      },
      cellUpdater: function( cell, data ) {
        // Update cell when change dataset has been called
        cell.title.setText( data.title );
      }
    } ).appendTo( this );

    // Create a scrolling indicator next to the grid to
    // indicate the position of the grid and ake it possible
    // to quickly skip between the pages of the grid
    var scrollIndicator = new MAF.control.ScrollIndicator( {
      styles: {
        height: controlGrid.height,
        width: 20,
        hOffset: this.width - 20
      }
    } ).appendTo( this );

    // Attach the scrollIndicator to the grid with news items
    scrollIndicator.attachToSource( controlGrid );
  },

  // When view is created or returning to view the view is updated
  updateView: function() {
    if ( this.backParams.reset !== false && !MAF.messages.exists( 'MyFeedData' ) )
      getData();
  }
} );</code></pre><p>In the code sample above we switched our grids <a href="../api/MAF.control.Grid/#function_changeDataset" target="_blank"><code>changeDataset</code></a> with the function for storing messages which works as followed; you call the function with the <a href="../api/MAF.messages/#function_store" target="_blank"><code>MAF.messages.store</code></a> function, this function uses two parameters, the <code>key</code> defines the value you are going to listen to, and <code>value</code> contains the data you requested from the server.</p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body">Using <a href="../api/Request/" target="_blank"><code>Request</code></a> is most of the times a vital point in your application. Please refrain to load unused data and try to optimize your api calls if possible. This will greatly boost your app's performance. We took a quick peek on how to store data, more on that subject can be found at <a href="#storingData" target="_blank">Storing Data</a>.</div></div></section></section><section><h1 id="theming">Theming</h1><section><h3 id="startTheming">Start painting the canvas</h3><p>Right now your application looks very basic, but there are ways to customize the style of your application. There are three ways to change the style of your application:</p><ol><li>When creating a new element, for setting the elements default value when the view is loaded.</li><li><code>elementName.setStyle(key, value)</code> and <code>elementName.setStyles({key1: value1, key2: value, etc..})</code>, both basicly do the same, however one <code>setStyle</code> only allows you to change one attribute and the other <code>setStyles</code> allows you to change multiple attributes of an element. These functions allow you to change your element while the application is running.</li><li>And the use of Theming</li></ol><p>Because you already seen the first two in the tutorial before, we will cover the third subject <a href="../api/Theme/" target="_blank"><code>Theming</code></a>. With this you can create a set of styles, like setting the applications font or focus color. The are two ways of using theming, adding the code to your init.js (or the view where it belongs to), or make a new javascript file. We recommend using the second method for large Themes this way you keep your init.js file nice and clean.</p><p>To start theming create a file called 'theme.js' and save it in the 'Javascript/core' folder and include it in your init.js file.</p><pre><code class="javascript">Theme.set( {
  BaseFocus: {
    styles: {
      backgroundColor: '#0198E1'
    }
  }
} );</code></pre><p>Several elements we used up until now have been from the controls type, these types will generate a DOM element with the class <code>BaseGlow</code>, which defines the default background. Once the element has focus the class will change from <code>BaseGlow</code> to <code>BaseFocus</code>. To disable this automatic theming on an element you can use the configuration variable <code>theme</code> which we have already seen once before, the correct usage of this variable is shown in the example below.</p><pre><code class="javascript">this.controls.ourTextButton = new MAF.control.TextButton( {
  label: $_('Bye!'),
  theme: false,
  styles: {</code></pre><p>When you start your application at this point you can see that the black background on the buttons has disappeared and there seems to be no focus color when you try to focus these buttons. In the following example we will show you a way to only change the style of the control buttons.</p><pre><code class="javascript">Theme.set( {
  view: {
    styles: {
      backgroundColor: '#2F2F80'
    }
  },
  BaseFocus: {
    styles: {
      backgroundColor: '#0198E1'
    }
  },
  ControlTextButton: {
    normal: {
      styles: {
        color: '#F1F1F1',
        backgroundColor: '#5F5DFF'
      }
    },
    focused: {
      styles: {
        backgroundColor: '#cf7458'
      }
    }
  }
} );</code></pre><p>When you look at the example above you can see we added a new class called <code>ControlTextButton</code> this points directly to the DOM element of a <a href="../api/MAF.control.TextButton/" target="_blank"><code>MAF.control.TextButton</code></a>. From now on it will use this way of styling.</p></section><section><h3 id="advancedTheming">Deeper into the paint</h3><p>Using subsets like normal and focused enables to specify a class deeper. The focused color CSS will be generated as <code>.ControlTextButton.focused {}</code>, this means that it is possible to create your own subsets if you append new Classes to your elements with <code>ClassName</code> as config or on the fly with the <code>yourInstance.element.addClass</code> and <code>yourInstance.element.removeClass</code> function. It is also possible to go deeper with the css, using a string as indentifier like <code>'ControlTextButton .FancyTextField'</code>, this way you target the FancyTextFields located in ControlTextButtons, the normal CSS rules (<code>></code>, <code>+</code>, <code>:before</code>, <code>:after</code>, <code>:first-child</code>) can be used here. An important thing to know, is that some of the newer (CSS3) properties, like textShadow, are not supported on every settop box. When you make use of these properties they can be filtered on the settop box that is lacking that functionality. An example of using the normal CSS rules would look like this, notice that the first dot is skipped as it is generated by MAF, thus only accepting class names as the first node not ids.</p><pre><code class="javascript">Theme.set( {
  'dialog > .frame > .text':{
    styles: {
      borderBottom: 0,
      paddingLeft: '30px',
      paddingRight: '30px'
    }
  },
  'AboutBoxView .AboutBoxViewMetadataAuthorNote': {
    styles: {
      vOffset: '350px',
      hOffset: '130px'
    }
  },
  'ControlTextButton.redButton': {
    styles: {
      backgroundColor: 'red'
    }
  },
  'ControlTextButton.greenButton': {
    styles: {
      backgroundColor: 'green'
    }
  }
} );</code></pre><pre class="javascript"><code>this.controls.ourTextButton = new MAF.control.TextButton( {
  label: $_('Bye!'),
  events:{
    onSelect: function() {
      if ( $_('Bye!') === this.text ) {
        this.setText( $_('Hello!') );
        this.element.addClass('redButton');
        this.element.removeClass('greenButton');
      } else {
        this.setText( $_('Bye!') );
        this.element.addClass('greenButton');
        this.element.removeClass('redButton');
      }
    }
  }
} ).appendTo( this );</code></pre></section><section><h3 id="fontAwesome">Font Awesome</h3><p>A couple of the shown examples already used the <a href="../api/FontAwesome/">Font Awesome wrapper</a>. Font Awesome is, just like the name implies, a font which contains a lot of modern day icons. These icons may not be the exact icons you would like to use but they still do their job. Using the <a href="../api/FontAwesome/">Font Awesome wrapper</a> instead of images speeds up the loading time of your app drastically, which results in a better flow. All of <a href="http://fontawesome.io/icons/">Font Awesome's icons</a> and <a href="http://fontawesome.io/examples/">Font Awesome's options</a>, like enlarging or stacking, are possible to add to your textlabel as shown in the following example.</p><pre><code class="javascript">cellCreator: function() {
  var cell = new MAF.control.GridCell( {
    events: {
      onSelect: function() {
        if ( cell.retrieve('checked') ) {
          cell.checkbox.setText(
            FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ] )
          );

          cell.store( 'checked', false );
        } else {
          cell.checkbox.setText(
            FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ], [ 'check', 'stack-1x' ] )
          );

          cell.store( 'checked', true );
        }
      }
    }
  } );

  cell.checkbox = new MAF.element.Text( {
    label: FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ] ),
    styles: {
      width: 40,
      vOffset: 10,
      hOffset: 25,
      color: '#c1b8a7'
    }
  } ).appendTo( cell );

  cell.label = new MAF.element.Text( {
    label: FontAwesome.get( 'camera-retro' ) + ' really nice picture of you',
    styles: {
      width: 400,
      vOffset: 10,
      hOffset: cell.checkbox.outerWidth,
      color: '#c1b8a7'
    }
  } ).appendTo( cell );

  return cell;
},</code></pre></section></section><section><h1 id="i18n">Internationalization & localization</h1><section><h3>Translating strings</h3><p>Application that run in multiple countries, may need to be translated accomodate most users. It is possible to define translation files and have the text's within your automatically be set to the locale the app is currently running in. To translate a string we make use of <a href="../api/widget/#function_getLocalizedString" target="_blank"><code>widget.getLocalizedString</code></a>. This method takes a string that is a key in one of your translation files and get's the value that is defined for it, in the current locale.<pre><code class="javascript">// Translation string (in translation file):
// "close_button_label" = "Close";

widget.getLocalizedString( 'close_button_label' ); // returns "Close"
      </code></pre>As an alternative to the <a href="../api/widget/#function_getLocalizedString" target="_blank"><code>widget.getLocalizedString</code></a> method, you may also use the global function <code>$_</code>.<pre><code class="javascript">// Translation string (in translation file):
// "play_button_label" = "Play";

$_( 'play_button_label' ); // returns "Play"
      </code></pre>Whether you want to use fulltext as a label to be user friendly (a fallback will then always be available when you forget to translate a specific label), or you just want to use meaningfull semantic labels in your translations files is completely up to you. It does not change the implementation and has no effect on how your app works.</p><p>So where do these translation files live? The reside in the <code>Localization</code> folder of the <code>Contents</code> folder of your app. They go by the naming convention of <code>locale-COUNTRY.strings</code>, <code>nl-NL.strings</code>, for example. Translation files have the following structure:<pre><code class="javascript">// NL
"NoFavos"    = "Geen favorieten gevonden";
"NoSets"     = "Geen sets gevonden";
"NoTags"     = "Geen tags gevonden";
"NoContacts" = "Geen contacten gevonden";

"UserInfo1" = "Naam";
"UserInfo2" = "Gebruikersnaam";
"UserInfo3" = "ID";

"perms01" = "Alleen jij kunt dit zien ";
"perms02" = "Alleen vrienden kunnen dit zien ";
"perms03" = "Alleen familie kan dit zien ";
"perms04" = "Alleen vrienden en/of familie kunnen dit zien ";
"perms05" = "Iedereen kan dit zien ";

"Favourites"  = "Favorieten";
"views"       = "keer bekeken";
"taken"       = "Genomen op";
"interesting" = "Interessant";
"nearby"      = "Dichtbij";
      </code></pre>Most important here are the quotes and semi-colons. Whitespace has no importance. And the <code>// NL</code> at the top is optional.</p><p>Your app always requires at least one language file. Therefore, a best practice is to always define the default <code>en-EU.strings</code> file.</p><p></p><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body"><a href="../api/widget/#function_getLocalizedString" target="_blank"><code>widget.getLocalizedString</code></a> and it's shortcut method <code>$_</code> are essential methods in the MAF-SDK, they allow you to make your app suitable for a multilingual audience and to distribute it in many countries.</div></div></section></section><section><h1 id="media">Playing media</h1><section><h3>Its a TV app after all</h3><p>Applications can display more than just text. It is also possible to load in audio and video to show to your users. To play media we make use of <a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a>, this handles all events needed to play videos or music. Basic events such as play, stop, forward, rewind, and skipping numbers are handled by default. This way you are not enforced to configure a lot of things before you can play a video. You've probably noticed the checkered background which illustrates the area where you would normally see TV or your video, this background will be hidden on a settopbox. The following example can be found in the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.VideoTemplate" target="_blank">VideoTemplate</a>, but is edited for the sake of this example.</p><pre><code class="javascript">// Create a class and extended it from the MAF.system.FullscreenView
var videoView = new MAF.Class( {
  Extends: MAF.system.FullscreenView,
  ClassName: 'videoView',

  // Add back params when going to the previous view
  viewBackParams: { reset: false },

  // Initialize your view
  initView: function() {
    MAF.mediaplayer.init(); // Initialize mediaplayer
  },

  // Create your view template
  createView: function() {

    // Create the Media Transport Overlay
    var mediaTransportOverlay = new MAF.control.MediaTransportOverlay({
      theme: false,
      // Set the order of the buttons
      buttonOrder: [ 'rewindButton', 'playButton', 'stopButton', 'forwardButton' ],
      buttonOffset: 20,   // Set the default space before and after the buttons
      buttonSpacing: 20,  // Set the space between the buttons
      fadeTimeout: 6,     // Set the fader of the overlay to start after 6 seconds
      playButton: true,   // Enable the "play" button
      stopButton: false,  // Disable the "stop" button
      rewindButton: true, // Enable the "rewind" button
      forwardButton: true // Enable the "fast forward" button
    } ).appendTo( this );
  },

  gotKeyPress: function( evt ) {
    if ( 'stop' === evt.payload.key )
      MAF.application.previousView();
  },

  // The channelChanged function is called when you change the channel of your TV
  onChannelChanged: function() {
    MAF.application.previousView();
  },

  // When view is created or returning to view the view is updated
  updateView: function() {
    this.onChannelChanged.subscribeTo( MAF.mediaplayer, 'onChannelChange' );
    this.gotKeyPress.subscribeTo( MAF.application, 'onWidgetKeyPress' );

    // Add a new playlist with the video to the player
    var entry = new MAF.media.PlaylistEntry( {
      url: 'http://video.metrological.com/aquarium.mp4',
      asset: new MAF.media.Asset( 'Aquarium' )
    } );

    MAF.mediaplayer.playlist.set( new MAF.media.Playlist().addEntry( entry ) );

    // Start the video playback
    MAF.mediaplayer.playlist.start();
  },

  // The hideView is called when you're leaving this view
  hideView: function () {
    this.onChannelChanged.unsubscribeFrom( MAF.mediaplayer, 'onChannelChange' );
    this.gotKeyPress.unsubscribeFrom( MAF.application, 'onWidgetKeyPress' );
  }
} );</code></pre><ol><li>We built up our standard class or view for with the usual functions <a href="../api/MAF.system.BaseView/#function_initialize" target="_blank"><code>initialize</code></a>, <a href="../api/MAF.system.BaseView/#function_createView" target="_blank"><code>createView</code></a>, and <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a>.</li><li>Then in the <a href="../api/MAF.system.BaseView/#function_initialize" target="_blank"><code>initialize</code></a> function we also initialized our mediaplayer with the function <a href="../api/MAF.mediaplayer/#function_init" target="_blank"><code>MAF.mediaplayer.init</code></a>. Without the initialization our <a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a> will not work.</li><li>In the <a href="../api/MAF.system.BaseView/#function_createView" target="_blank"><code>createView</code></a> we added a <a href="../api/MAF.control.MediaTransportOverlay/" target="_blank"><code>MAF.control.MediaTransportOverlay</code></a>, this is a default player with multiple buttons, time labels, and a time bar. The <code>forwardseekbutton</code> and <code>backwardseetButton</code> are disabled by default, so you will have to enable them with their configuration variables.</li><li>We wanted to start our video when loading our view, to do this you have to add some code to the <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function. You have to create a playlist first, which you can retrieve with <a href="../api/MAF.media.playlist/" target="_blank"><code>MAF.media.Playlist</code></a>. This time we wanted to play a video through use of an URL, to do so you use the <a href="../api/MAF.media.playlist/#function_addEntryByURL" target="_blank"><code>addEntryByURL</code></a> function, with this function you give the URL as a string parameter, or create your own <a href="../api/MAF.media.PlaylistEntry/" target="_blank"><code>MAF.media.PlaylistEntry</code></a> and add it with the <a href="../api/MAF.media.playlist/#function_addEntry" target="_blank"><code>addEntry</code></a> function.</li><li>Now you can set the playlist for the mediaplayer with the <a href="../api/MAF.media.playlist/#function_set" target="_blank"><code>MAF.mediaplayer.playlist.set</code></a> function, and start the mediaplayer with <a href="../api/MAF.media.playlist/#function_start" target="_blank"><code>MAF.mediaplayer.playlist.start</code></a> function.</li><li>In the case a user presses the stop button or an error occurs, we wanted the application go back to the previous view. To do this you have to create a function that will handle events in case the mediaplayer changes its state. We called the function <code>handleMediaEvents</code>, to make this function listen to state changes you have to add a call in the <a href="../api/MAF.system.BaseView/#function_initialize" target="_blank"><code>initialize</code></a> function of the view. In this case you have the function <code>handleMediaEvents</code> call the <a href="../api/Function/#function_subscribeTo" target="_blank"><code>subscribeTo</code></a> function, with this function you give two parameters, the listener, and the event that occurs. In your case <a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a> and <a href="../api/MAF.mediaplayer/#event_onStateChange" target="_blank"><code>onStateChange</code></a>.</li></ol><div class="panel panel-default"><div class="panel-heading">Conclusion</div><div class="panel-body"><a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a> is an essential component in the MAF-SDK, the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.VideoTemplate" target="_blank">VideoTemplate</a> hold various ways of implementing this mediaplayer. For more information on <a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a> please look in the Class Reference.</div></div></section></section><section><h1 id="storingData">Storing data</h1><section><h3 id="passingData">Passing data to the next or previous view.</h3><p>The easiest way of passing data to our next view is with the use of the <a href="../api/MAF.system.BaseView/" target="_blank"><code>persist</code></a> and <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a>. These objects can be accessed as a sub object from the <code>view</code> you are on. If you are not able to reach the <code>view</code> with <code>this</code> you will have to fetch it before you are able to call for the <a href="../api/MAF.system.BaseView/" target="_blank"><code>persist</code></a> and <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a>.</p><pre><code class="javascript">createView: function() {
  console.log( this.persist );
  console.log( this.backParams );
}</code></pre><p>The <a href="../api/MAF.system.BaseView/" target="_blank"><code>persist</code></a> is used to pass along data to the next view with the <a href="../api/MAF.application/#function_loadView" target="_blank"><code>loadView</code></a> function or renew your persist with the <a href="../api/MAF.application/#function_reloadView" target="_blank"><code>reloadView</code></a> function. As long as a view remains in the history its <a href="../api/MAF.system.BaseView/" target="_blank"><code>persist</code></a> data remains in tact.</p><pre><code class="javascript">MAF.application.loadView( 'GridView', { name: 'Bob', age: 19 } );</code></pre><pre><code class="javascript">MAF.application.reloadView( { name: 'Bob', age: 19 } );</code></pre><p>As the name suggest the <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a> are there once you go back to a previous view. Maybe one of your views fetches new data from an API on every <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function call. But that might change the data that was already on that view, which you might not want at that moment. That is where the <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a> come into our application.</p><pre><code class="javascript">MAF.application.previousView( { noReset: true } );</code></pre><p>If you place an <code>if</code> statement like <code>if(this.backParams.noReset)</code> in your <a href="../api/MAF.system.BaseView/#function_updateView" target="_blank"><code>updateView</code></a> function you can blockout renewing data if you come back from a previous view. If you make use of your <code>physical backspace button</code> or <a href="../api/MAF.control.BackButton/" target="_blank"><code>MAF.control.BackButton</code></a> we encourage you to add the <code>viewBackParams</code> object to your view class. These buttons will send this object as <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a> to the previous view.</p><pre><code class="javascript">viewBackParams: { noReset: true },</code></pre><p>It is also possible to mutate your <a href="../api/MAF.system.BaseView/" target="_blank"><code>persist</code></a> and <a href="../api/MAF.system.BaseView/" target="_blank"><code>backParams</code></a> like any other object.</p></section><section><h3 id="tempStoringMessages">Temporary storing in MAF.messages</h3><p>While using the <a href="../api/Request/"><code>Request</code></a> to fill our <a href="../api/MAF.element.Grid/" target="_blank"><code>MAF.element.Grid</code></a> we have already used <a href="../api/MAF.messages/" target="_blank"><code>MAF.messages</code></a> to work with data. Through <a href="../api/MAF.messages/#function_store" target="_blank"><code>storing</code></a> and <a href="../api/MAF.messages/#function_fetch" target="_blank"><code>fetching</code></a> data it is possible to share information between views. You can of course use the persist object for sending data to the next view, but storing your information in the messages system is convenient when sharing the same object to multiple views that do not use a linear flow or for information that has to be accessible everywhere.</p><pre><code class="javascript">MAF.messages.store( 'currentUser', { name: 'John Doe', age: 26, work: 'salesman' } );</code></pre><p>From now on there is an object called currentUser ready at your disposal. The object is now ready everywhere you want to call it. It doesn't matter what scope it is where you want to call it because <a href="../api/MAF.messages/" target="_blank"><code>MAF.messages</code></a> is accessible everywhere. To check which content is in the object while developing you can use the following line</p><pre><code class="javascript">console.log( MAF.messages.fetch( 'currentUser' ) );</code></pre><p>If you added a listener to <a href="../api/MAF.messages/" target="_blank"><code>MAF.messages</code></a> (see <a href="#requests">requests</a>) it uses the name of an object as key and the object itself as value, which can both be aquired from <code>event.payload</code>.</p><p>There are a few more interesting functions for <a href="../api/MAF.messages/" target="_blank"><code>MAF.messages</code></a> so be sure to check them in the Class Reference so you dont miss out on them.</p></section><section><h3 id="tempStoringElements">Temporary storing in MAF elements</h3><p>A third method to store data is on an element itself, for example a Button or a GridCell. This way you can retrieve the data without having to address another element or the parent view. It is very useful if you want to access data through use of events that are linked to an element, or when you loop through a number elements. To store data into an element use the <code>store</code> function on the element itself, to get data from the element use the <code>retrieve</code> function. A downside of this method is that the data is only available as long as the element is available. Once it is gone, so is your data.</p><pre><code class="javascript">_cellCreator: function() {
  var cell = new MAF.control.GridCell( {
    events: {
      onSelect: function() {
        if ( cell.retrieve( 'checked' ) ) {
          cell.checkbox.setText(
            FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ] )
          );

          cell.store( 'checked', false );
        } else {
          cell.checkbox.setText(
            FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ], [ 'check', 'stack-1x' ] )
          );

          cell.store( 'checked', true );
        }
      }
    }
  } );

  cell.checkbox = new MAF.element.Text( {
    label: FontAwesome.get( 'stack', [ 'square-o', 'stack-2x' ] ),
    styles: {
      width: 40,
      vOffset: 10,
      hOffset: 25,
      color: '#c1b8a7'
    }
  } ).appendTo( cell );

  return cell;
},</code></pre></section><section><h3 id="permStoring">Permanent storing in the app</h3><p>There are two ways of permanent storing, <code>currentAppConfig</code> for storing at application level and <code>currentAppData</code> for storing data at profile per application level. Both have a <code>set</code> and <code>get</code> function to store and retrieve data with. Everything stored in these objects will be accessible until your browser data is cleared, or a factory reset on a set-top box. Some data belongs to a user and some data belongs to the application itself, so give it a thought before using it. Overall highscores for example need to be stored in the <code>currentAppConfig</code>, if you store it in the <code>currentAppData</code> and another profile is switched the other person cannot view those highscores. Personal records however could be stored within <code>currentAppData</code>, depending on if the other profiles should have access or not, if you want them to access the other user's personal records, store them into the <code>currentAppConfig</code> instead. As the name suggests <code>currentAppConfig</code> has its origins in storing application settings, like for example whether to use Fahrenheit or Degrees.</p><pre><code class="javascript">storeHighscores: function( scores ) {
      currentAppConfig.set( 'Highscores', scores );
    },

    updateView: function() {
      updateSidebar( true );

      var scores = currentAppConfig.get( 'Highscores' ) || [];

      if ( scores.length ) {
        this.elements.grid.changeDataset( scores, true );

        this.elements.grid.visible          = true;
        this.elements.pageIndicator.visible = true;
        this.elements.noScores.visible      = false;
      } else {
        this.elements.grid.visible          = false;
        this.elements.pageIndicator.visible = false;
        this.elements.noScores.visible      = true;
      }
    }</code></pre></section></section><section><h1 id="socialMedia">Social Media</h1><section><h3 id="twitterObject">Twitter</h3><p>The <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object is a wrapper which simplifies calls to the <a href="https://dev.twitter.com/docs/api/1.1" target="_blank">Twitter api</a> and handles the authentication for you. This means that we don't have any control of the inner workings of the api itself. The <a href="../api/Twitter/#function_api" target="_blank"><code>api</code></a> function makes use of the paths specified by Twitter (ex. 'statuses/home_timeline', 'statuses/show/:id' and 'search/tweets'). When the user is not yet authenticated MAF launches the login sequence instead of doing the actual call.</p><p>To fetch the authenticated user's profile information like name and profile picture the code looks like this.</p><pre><code class="javascript">Twitter.api( 'me', function( me ) {
  // this trigger not caused by user not authorized.
  currentAppData.set( 'myProfile', me );
} );</code></pre><p>If you wonder how to place a tweet, the following function can be helpful.</p><pre><code class="javascript">function postTweet( tweetMsg, status_id ) {
  var parameters = status_id ? { in_reply_to_status_id: status_id, status: tweetMsg } : { status: tweetMsg };

  Twitter.api( 'statuses/update', 'post', parameters, function( response ) {
    // this trigger not caused by user not authorized.
    MAF.messages.store( 'tweeted', response );
  } );
};</code></pre><p>It is also possible to add listeners to the <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object, which fires the <a href="../api/Twitter/#event_onConnected" target="_blank"><code>onConnected</code></a>,<a href="../api/Twitter/#event_onDisconnected" target="_blank"> <code>onDisconnected</code></a> and <a href="../api/Twitter/#event_onUnpairedProfile" target="_blank"><code>onUnpairedProfile</code></a> event. This way you can take action when a user is connected, disconnected or unpaired.</p><pre><code class="javascript">var HomeView = new MAF.Class( {
  Extends: MAF.system.SidebarView,
  ClassName: 'HomeView',

  initView: function() {
    this.twitterSubscribe = this.twitterEvents.subscribeTo(
      Twitter,
      [ 'onUnpairedProfile', 'onConnected', 'onDisconnected' ],
      this
    );
  },

  twitterEvents: function( evt ) {
    switch ( evt.type ) {
      case 'onUnpairedProfile':
        //Do something
        break;
      case 'onDisconnected':
        //Do something
        break;
      case 'onConnected':
        //Do something
        break;
    }
  },

  destroyView: function() {
    this.twitterSubscribe.unsubscribeFrom( Twitter, [ 'onUnpairedProfile', 'onConnected', 'onDisconnected' ] );
    this.twitterSubscribe = null;
  }
} );</code></pre><p>More on the <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object can be found in the Class Reference</p></section><section><h3 id="facebookObject">Facebook</h3><p>The <a href="../api/Facebook/" target="_blank"><code>Facebook</code></a> object is,like <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a>, a wrapper around the original <a href="https://developers.facebook.com/graph-api/reference">Facebook Graph api</a> and works the same as the <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object. Though the endpoints passed down the <a href="../api/Facebook/#function_api" target="_blank"><code>api</code></a> function may be different, as the wrapper does not change these.</p><pre><code class="javascript">Facebook.api( 'me', function( me ) {
  // this trigger not caused by user not authorized.
  currentAppData.set( 'myProfile', me );
} );</code></pre><p>Placing posts for example is with a different endpoint then with the <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object.</p><pre><code class="javascript">function postMessage( message ) {
  Facebook.api( Facebook.userId + '/feed', 'post', { message: message }, function( response ) {
    // this trigger not caused by user not authorized.
    MAF.messages.store( 'messagedPosted', response );
  } );
};</code></pre><p>But just like <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> you can listen to the same events by subscribing to the <a href="../api/Facebook/" target="_blank"><code>Facebook</code></a> object.</p><pre><code class="javascript">var HomeView = new MAF.Class( {
  Extends: MAF.system.SidebarView,
  ClassName: 'HomeView',

  initView: function() {
    this.facebookSubscribe = this.facebookEvents.subscribeTo(
      Facebook,
      [ 'onUnpairedProfile', 'onConnected', 'onDisconnected' ],
      this
    );
  },

  facebookEvents: function( evt ) {
    switch ( evt.type ) {
      case 'onUnpairedProfile':
        //Do something
        break;
      case 'onDisconnected':
        //Do something
        break;
      case 'onConnected':
        //Do something
        break;
    }
  },

  destroyView: function() {
    this.facebookSubscribe.unsubscribeFrom( Facebook, [ 'onUnpairedProfile', 'onConnected', 'onDisconnected' ] );
    this.facebookSubscribe = null;
  }
};</code></pre><p>More on the <a href="../api/Facebook/" target="_blank"><code>Facebook</code></a> object can be found in the Class Reference</p></section><section><h3 id="youtubeObject">Youtube</h3><p>The <a href="../api/Youtube/" target="_blank"><code>Youtube</code></a> object is actually the most simple of the three, but if you don't know how the <a href="../api/MAF.mediaplayer/" target="_blank"><code>MAF.mediaplayer</code></a> works yet please check the <a href="#media">getting started page</a> or the SDK page. The mediaplayer needs a video to play, but instead of adding the youtube url as item we will make use of the <a href="../api/Youtube/" target="_blank"><code>Youtube</code></a> object.</p><pre><code class="javascript">function playYoutubeVideo( videoID ) {
  YouTube.get( videoID, function( config ) {
    MAF.mediaplayer.playlist.set(
      ( new MAF.media.Playlist() ).addEntry( new MAF.media.PlaylistEntry( config ) )
    );

    MAF.mediaplayer.playlist.start();
  } );
}</code></pre><p>The <a href="../api/Youtube/#function_get" target="_blank"><code>get</code></a> function takes one parameter, which is the video's id as a <code>String</code> format. The video id can be found at the end of the Youtube link you want to use (example, https://www.youtube.com/watch?v=XxXxXxXxXxX). The function returns an object that has the correct items to initialize a <code>PlaylistEntry</code> which can be used as an entry to fill the <code>Playlist</code> with. Detailed information on the <a href="../api/Youtube/" target="_blank"><code>Youtube</code></a> object can be found in the Class Reference</p></section></section><section><h1 id="rooms">Communicating</h1><section><h3 id="roomUses">Start communicating</h3><p>External devices can be used as a way to enrich the way of controlling your app, for example, by turning your smartphone into a gamepad or swipe remote. By communicating with other MAF systems you could create a chat for those watching the same movie, make multiplayer games or create a shared <a href="../api/MAF.media.Playlist/" target="_blank"><code>MAF.media.Playlist</code></a> that gets updated when a friend adds another video. With the use of <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a> it is possible to do these communications. When you create a <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a> in your app, it will try to join it if the name already exists on our server or else make a new one. Rooms are bound to the app itself, so it wont be possible to access another app's <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a>.</p></section><section><h3 id="smartphoneRemote">Use your smartphone as remote</h3><p>Some functionality cannot be achieved with just the use of a default STB/TV remote. Most of these remotes work with infrared signals, meaning that you cannot press more than one button at a time. This could be a problem for playing some games, walking and shooting cannot be done at the same time. Aside of the button problem, your smartphone hold many other functionalities you can make use of, for example its touchscreen to draw with. This example can be found at the <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.Rooms" target="_blank">Rooms</a> example on Github.</p><pre><code>// Create a class and extended it from the MAF.system.SidebarView
var roomView = new MAF.Class( {
  ClassName: 'roomView',
  Extends: MAF.system.FullscreenView,

  initView: function() {

    // Create a Room across all households
    // this.room = new MAF.Room( this.ClassName );
    // Create a Room for this specific household
    this.room = new MAF.PrivateRoom( this.ClassName );
  },

  // Create your view template
  createView: function() {
    var room = this.room;
    // Keep track of the clients connected
    var clients = {};
...
    // Set listeners for Room and Connection
    ( function( evt ) {
      var payload = evt.payload;

      switch ( evt.type ) {
        case 'onConnected':
          log('room connected');
          // If connected but room not joined make sure to join it automaticly
          if ( !room.joined ) room.join();
          return;
        case 'onDisconnected':
          clients = {}; // Reset clients
          log('connection lost waiting for reconnect and automaticly rejoin');
          return;
        case 'onCreated':
          // Create an url to the client application and pass the hash as querystring
          var url = widget.getUrl( 'Client/draw.html?hash=' + payload.hash );
          qrcode.setSource( QRCode.get( url ) );
          log( 'room created', payload.hash, url );
          return;
        case 'onDestroyed':
          clients = {}; // Reset clients
          log('room destroyed', payload.hash);
          return;
        case 'onJoined':
          // If user is not the app then log the user
          if ( payload.user !== room.user )
            log('user joined', payload.user);
          return;
        case 'onHasLeft':
          // If user is not the app then log the user
          if ( payload.user !== room.user )
            log('user has left', payload.user);
          return;
        case 'onData':
          var data = payload.data;

          if ( 'draw' === data.e )
            return draw( data.c, data.k, data.x, data.y );
          if ( 'clear' === data.e )
            return reset();
          break;
        default:
          log(evt.type, payload);
          break;
      }
    } ).subscribeTo(
      room,
      [
        'onConnected',
        'onDisconnected',
        'onCreated',
        'onDestroyed',
        'onJoined',
        'onHasLeft',
        'onData',
        'onError'
      ]
    );

    // If Room socket is connected create and join room
    if ( room.connected ) room.join();
  },

  destroyView: function() {
    if ( this.room ) {
      // Leave room, will trigger an onLeaved of the app user
      this.room.leave();

      // Destroy the room
      this.room.destroy();

      // Unreference from view
      this.room = null;
    }
  }
} );</code></pre><p>To be able to use your smartphone we will need some kind of way of linking it with MAF. First we need to create a <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a> or <a href="../api/MAF.PrivateRoom/" target="_blank"><code>MAF.PrivateRoom</code></a> to log into, the difference between these two that the <a href="../api/MAF.PrivateRoom/" target="_blank"><code>MAF.PrivateRoom</code></a> is designed to work within one household, whereas the normal <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a> can be used to create cross household connections. For now we use a <a href="../api/MAF.PrivateRoom/" target="_blank"><code>MAF.PrivateRoom</code></a> because we are going to link a smartphone as a remote to an app, no other people from outside this household will benefit from joining this room. Once the <a href="../api/MAF.PrivateRoom/" target="_blank"><code>MAF.PrivateRoom</code></a> is created we will need some way to let the device join the <a href="../api/MAF.PrivateRoom/" target="_blank"><code>MAF.PrivateRoom</code></a>, we are going to do that with a <a href="../api/QRCode/" target="_blank"><code>QRCode</code></a>. To generate the <a href="../api/QRCode/" target="_blank"><code>QRCode</code></a> we can use the <a href="../api/QRCode/#function_get" target="_blank"><code>get</code></a> function to pass down the url of the page you want to show on your device, including the room's hash. To get the path to the html page use the <a href="../api/widget/#function_getUrl" target="_blank"><code>getUrl</code></a> function of the <a href="../api/widget/" target="_blank"><code>widget</code></a> instance to get the app's path and add your own html file's path to it. This file will be responsible to send some kind of data back to the app. in our case it will be coordinates of lines that need to be drawn on the app's canvas. In order to do that <a href="https://github.com/Metrological/maf3-sdk/blob/master/apps/com.metrological.app.Rooms/Contents/Client/maf-room.min.js" target="_blank">maf-room.min.js</a> has to be included in the device's html. Without it it cannot be used to send data back to the servers.</p><pre><code>var Draw = ( function( c ) {
    var enabled = false;
    var room = new MAF.Room();

    room.addEventListener( 'joined', function( evt ) {
      // A client has joined
      console.log('user joined', evt.user);
    } );

    room.addEventListener( 'data', function( evt ) {
      var d  = evt.data,
      var fn = Canvas[ d.e];
      return fn && fn( d.c, d.k, d.x, d.y );
    } );

    window.addEventListener( 'unload', function() {
      room.destroy();
      room = null;
    }, false );

    function start( x, y ) {
      enabled = true;

      room.send( {
        e: 'draw',
        k: 'start',
        c: c,
        x: x,
        y: y
      } );
    }

    function end( x, y ) {
      enabled = false;

      room.send( {
        e: 'draw',
        k: 'end',
        c: c,
        x: x,
        y: y
      } );
    }

    function paint( x, y ) {
      if ( enabled )
        room.send( {
          e: 'draw',
          k: 'paint',
          c: c,
          x: x,
          y: y
        } );
    }

    return {
      start: start,
      end: end,
      paint: paint
    }
  }( getRandomColor() ) );</code></pre><p>To send data back use the <a href="../api/MAF.Room/#function_send" target="_blank"><code>send</code></a> function of <a href="../api/MAF.Room/" target="_blank"><code>MAF.Room</code></a> that is accessible through the included script. The <a href="../api/Function/#function_subscribeTo" target="_blank"><code>subscribeTo</code></a> in your app will be fired with <a href="../api/MAF.Room/#event_onData" target="_blank"><code>onData</code></a> which gives the oppertunity to work with the data, in this case update our canvas in the app to show the drawing that is made on the smartphone. Another way of using your smartphone as remote is by turning it into a swipe remote, a gamepad or a image gallery. The possibilities are almost endless as you can use html to build your remote with.</p></section></section><section><h1 id="closingApp">Closing your app</h1><section><h3>Leave no garbage behind</h3><p>While developing it is also important to know what happens when you close your application. MAF takes care of closing the application and cleaning most objects, but sometimes unexpected things can happen like warning logs or even crashes. If it happens it most likely is one of the following causes:</p><h4>Warnings</h4><ul><li>Global scope pollution</li><li>Memory leaks</li></ul><h4>Code ran after the app is closed by:</h4><ul><li>Listeners</li><li>Timers</li><li>Events</li></ul><p>Most of these errors and warnings can be fixed in the <a href="../api/MAF.system.BaseView/#function_destroyView" target="_blank"><code>destroyView</code></a> function of the view, but some <code>Global scope pollution</code> warning not appear in the first place. When the error occurs it means that the application has a variable declared outside of the application's scope. This means that if another application makes use of the same global variablename it uses the previous application's data. That is why all variables cannot go outside of the view's scope. Most of the time this goes by accident, if you forget to store your variable to your local scope (this.varName) or forget the <code>var</code> declaration statement before your variable name when you initialize it, the variable will be out in the global scope. It is also possible that you wanted to declare it global on purpose, when you like to share content with other views for example, there are more useful methods available.</p><p>When MAF cannot clear all of your data memory leaks occur. If multiple applications with memory leaks are opened and closed the settop box will crash by a flooded memory. That's why it is important to empty and dereference all variables that MAF cannot destroy for you. Application crashes when closing the application are most likely caused by code that is executed after MAF cleared references to the used object, so if you made your own button that closes the app, be sure that there is no other code ran after the close command. It may also be possible that event code (like <a href="../api/MAF.element.Grid/#event_onDatasetChanged" target="_blank"><code>onDatasetChanged</code></a> on a <a href="../api/MAF.element.Grid/" target="_blank"><code>Grid</code></a>), listener code (like <a href="../api/Twitter/#event_onConnected" target="_blank"><code>onConnected</code></a> on the <a href="../api/Twitter/" target="_blank"><code>Twitter</code></a> object) or timer code (<code>setInterval</code>, <code>defer</code>) is ran after the application closed. Thats why it is important to stop timers and listeners in the <a href="../api/MAF.system.BaseView/#function_destroyView" target="_blank"><code>destroyView</code></a> function and check on existances in event codeblocks. Please keep in mind that the <a href="../api/MAF.system.BaseView/#function_hideView" target="_blank"><code>hideView</code></a> method will not be called when your application closes.</p><p>An example of an application clearing it's garbage looks like this:<pre><code class="javascript">destroyView: function() {
  this.varOne = null;
  this.varTwo = null;
  this.varThree = null;

  this.stateChange.unsubscribeFrom( MAF.mediaplayer, 'onStateChange' );
  this.stateChange = null;
}</code></pre></p><p>If no warnings or errors pop in your console log the application closes correctly and you have nothing to worry about. But make it a habit of always stopping timers and listeners as settop boxes most likely run slower than your developing machine, thus might run other code after the application is closed instead of just in time.</p></section></section><section><h1 id="externalAPI">External API's</h1><section><h3>Why build what is already made?</h3><p>MAF-SDK has installed a few javascript libraries for you to work with, these work the same as described on their own websites.</p><ul><li><a href="http://momentjs.com/">Moment.js</a></li><li><a href="http://bgrins.github.io/TinyColor/">TinyColor</a></li><li><a href="http://numeraljs.com/">Numeral.js</a></li><li><a href="https://github.com/LibertyGlobal/Guide-SDK">TV Guide JS SDK</a> (Please note that this library can only be used with settopboxes of Liberty Global)</li></ul><br><br><br><br></section></section></article></div></section><section id="sidepanel"><nav id="target_nav" class="navigation-container target_nav bs-docs-sidebar scrollspy-active"><ul class="nav bs-docs-sidenav main-items"><li><a href="#introduction" data-target="#introduction">Getting started</a></li><li><a href="#examples" data-target="#examples">Example Apps</a></li><li><a href="#howto" data-target="#howto">How to build your first App</a></li><li><a href="#setup" data-target="#setup">Setup</a></li><li><a href="#config" data-target="#config">Common Configuration</a></li><li><a href="#filesystem" data-target="#filesystem">Filesystem</a></li><li><a href="#metadata" data-target="#metadata">Metadata</a></li><li><a href="#publish" data-target="#publish">Publish your App</a></li><li><a href="#navigation" data-target="#navigation">Navigating your App</a></li><li><a href="#sidebarFullscreen" data-target="#sidebarFullscreen">Sidebar or Fullscreen</a></li><li><a href="#helloWorld" data-target="#helloWorld">Hello World</a></li><li><a href="#buttonsEvents" data-target="#buttonsEvents">Buttons and Events</a><ul class="nav collapse"><li><a href="#buttons" data-target="#buttons">Adding a button</a></li><li><a href="#subscribeEvent" data-target="#subscribeEvent">Subscribing to events</a></li></ul></li><li><a href="#newView" data-target="#newView">Loading a new View</a><ul class="nav collapse"><li><a href="#lifecycle" data-target="#lifecycle">Application lifecycle</a></li><li><a href="#createupdate" data-target="#createupdate">CreateView and UpdateView</a></li></ul></li><li><a href="#grids" data-target="#grids">Grids</a></li><li><a href="#requests" data-target="#requests">Requests</a><ul class="nav collapse"><li><a href="#requestingData" data-target="#requestingData">Requesting data</a></li><li><a href="#splitRequests" data-target="#splitRequests">Split requests from views</a></li></ul></li><li><a href="#theming" data-target="#theming">Theming</a><ul class="nav collapse"><li><a href="#startTheming" data-target="#startTheming">Start painting the canvas</a></li><li><a href="#advancedTheming" data-target="#advancedTheming">Deeper into the paint</a></li><li><a href="#fontAwesome" data-target="#fontAwesome">Font Awesome</a></li></ul></li><li><a href="#i18n" data-target="#i18n">i18n & l10n</a></li><li><a href="#media" data-target="#media">Playing Media</a></li><li><a href="#storingData" data-target="#storingData">Storing data</a><ul class="nav collapse"><li><a href="#passingData" data-target="#passingData">Passing data</a></li><li><a href="#tempStoringMessages" data-target="#tempStoringMessages">Temporary storing in messages</a></li><li><a href="#tempStoringElements" data-target="#tempStoringElements">Temporary storing in elements</a></li><li><a href="#permStoring" data-target="#permStoring">Permanent storing in the app</a></li></ul></li><li><a href="#socialMedia" data-target="#socialMedia">Social Media</a><ul class="nav collapse"><li><a href="#twitterObject" data-target="#twitterObject">Twitter</a></li><li><a href="#facebookObject" data-target="#facebookObject">Facebook</a></li><li><a href="#youtubeObject" data-target="#youtubeObject">Youtube</a></li></ul></li><li><a href="#rooms" data-target="#rooms">Communicating</a><ul class="nav collapse"><li><a href="#roomUses" data-target="#roomUses">Start communicating</a></li><li><a href="#smartphoneRemote" data-target="#smartphoneRemote">Your smartphone as remote</a></li></ul></li><li><a href="#closingApp" data-target="#closingApp">Closing your app</a></li><li><a href="#externalAPI" data-target="#externalAPI">External API's</a></li></ul></nav></section></section><footer><div class="container"><div class="footer-logo"><img src="../img/logo-footer.png" width="145" height="26"></div><div class="footer-left"><ul><li><a href="https://www.metrological.com/news.html" target="_blank">News</a></li><li><a href="https://www.metrological.com/careers.html" target="_blank">Careers</a></li></ul></div><div class="footer-right"><ul><li><strong>Copyright Â© 2017</strong> Metrological</li></ul></div></div></footer><div id="spotlight_wrapper"><input type="text" id="spotlight" placeholder="Search"><ul></ul></div><script src="../docs.min.js"></script></body></html>