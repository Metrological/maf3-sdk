// Copyright 1999-2014 SeaChange International
// All Rights Reserved.
NAF.conf={"debug":2,"upcPrice":false,"provideDefaultSettings":true,"mwReadyWaitTime":30,"isAppDefinedNormalMode":true,"chanlocsrc":"traxis","traxisidprefix":"CpeId","boRequestTimeout":60,"mapRequestTimeout":30,"maxRequests":0,"codcatalog":"root","enableHttpVod":false,"catchUpCategory":"","maxCODOrphans":10,"codOrphanTimeout":1800,"titleSchema":{"basic":["name","pictures","isAdult"],"extended":["name","shortName","shortSynopsis","longSynopsis","isViewable","isEntitled","isPreview","isAdult","ageRating",
"pictures","contents","events","previews","genres","seasonNum","episodeNum","episodeName","seriesName","isViewedCompletely","productionDate","broadcastDate","bookmark","productionLocations","actors","directors","customProperties"]},"vodSessionTearDownTimeout":1080,"vodEndPadding":95,"vodStartPadding":5,"parentGenres":["","MOVIE","NEWS","VARIETY & GAME SHOWS","SPORT","KIDS & YOUTH","MUSIC & DANCE","ARTS & CULTURE","CURRENT AFFAIRS","EDUCATIONAL","LEISURE","SPECIAL","ENTERTAINMENT","CRIME","TV SERIES",
"ADULT"],"eRouterHost":"dawncmpriv","wifiHost":"dawnwifi","eRouterAdminName":"admin","eRouterAdminPassword":"admin","eRouterRetry":0,"eRouterRetryInterval":10,"numhours":6,"refreshInterval":0,"refreshInterval0":3600,"eventsInitInChunks":150,"eventsRefreshInChunks":20,"eventsRefreshTimeout":0,"maxChannelCategories":1,"epgTimeBlock":3,"reminderTime":2,"reminderRefreshInterval":7200,"tuneByChanLocator":false,"pretune":true,"previouspretunes":0,"followingpretunes":1,"teletextHandling":false,"langTimeOut":500,
"chanUpDownKeyHandling":false,"startChannel":"CNN","initChannel":"lastViewed","setLastViewedWaitingTime":10,"catchUpChannel":0,"maxPinAttempts":3,"pinRetryInterval":300,"pinAttemptsDuration":300,"profileAgeRating":0,"removeURLOnTrickPlay":true,"allowMismatchedEventFromSameChannel":true,"pinForPurchase":true,"maxHistory":5,"maxHistoryDuration":0,"automaticBlockAdult":true,"blockUnratedTitleEvents":false,"standbyScheduledRecPadding":300,"useNewRecordingManager":true,"pvrDurationUpdateInterval":5E3,
"pvrDurationUpdateAllInterval":6E4,"notificationInterval":1E3,"bufferUpdateInterval":300,"isBusyResetTime":5E3,"minDiagPollInterval":15E3,"genreData":JSON.stringify({"genres":[{"code":"1","name":"movie","subgenres":[]},{"code":"2","name":"news","subgenres":[]},{"code":"3","name":"show","subgenres":[]},{"code":"4","name":"sports","subgenres":[]},{"code":"5","name":"children's","subgenres":[]},{"code":"6","name":"music","subgenres":[]},{"code":"7","name":"arts","subgenres":[]},{"code":"8","name":"social",
"subgenres":[]},{"code":"9","name":"education","subgenres":[]},{"code":"10","name":"leisure","subgenres":[]},{"code":"11","name":"special","subgenres":[]},{"code":"12","name":"entertainment","subgenres":[]},{"code":"13","name":"crime","subgenres":[]},{"code":"14","name":"series","subgenres":[]},{"code":"15","name":"adult","subgenres":[]}]}),"applications":[{"id":"id1","name":"MetrologicalAppStore","shortSynopsis":"The Metrological App Store","isAdult":false,"isViewable":true,"isEntitled":true,"url":"http://widgets.metrological.com/dawn/pl/development/#",
"type":"store"}],"bkwdCompatibleNotifications":false,"maxRecommendations":30,"recommendationTimeout":1800,"maxSearches":2,"searchTimeout":1800,"defaultSearchSource":"all","tvType":"50hz","audioFormat":{"auto":"stereo","dolby":"ac3","stereo":"stereo"},"SWUpdateProgInterval":1,"mediawareip":"","channelRefreshInterval":82800,"profileRefreshInterval":0,"enableCODCategorySingleFetch":true,"diagInterval":3E4,"resetCpeOnFirstInstall":false,"wifiPollInterval":5};
NAF.conf.hdmiComponent=NAF.conf.tvType=="50hz"?{"1080p":"1080p50hz2d","1080i":"1080i50hz2d","720p":"720p50hz2d","576p":"576p50hz2d","auto":"576i25hz2d"}:{"1080p":"1080p60hz2d","1080i":"1080i30hz2d","720p":"720p60hz2d","480p":"480p60hz2d","auto":"480i30hz2d","preferred":"preferred"};
function nafCleanupConf(){if(NAF.conf.canned)NAF.conf.traxisid="";if(NAF.conf.defaultSearchSource!="all"&&NAF.conf.defaultSearchSource!="title"&&NAF.conf.defaultSearchSource!="event"&&NAF.conf.defaultSearchSource!="recording"&&NAF.conf.defaultSearchSource!="title,event"&&NAF.conf.defaultSearchSource!="event,title")NAF.conf.defaultSearchSource="all";if(typeof window!=="undefined"){var vars=[],hash;var hashes=location.href.slice(location.href.indexOf("?")+1).split("&");for(var i=0;i<hashes.length;i++){hash=
hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}for(var i=0,varLength=vars.length;i<varLength;i++){var lowerVar=vars[i].toLowerCase();for(var prop in NAF.conf)if(lowerVar==prop.toLowerCase()){var p=vars[vars[i]];if(!isNaN(p))NAF.conf[prop]=parseFloat(p,10);else if(p==="true")NAF.conf[prop]=true;else if(p==="false")NAF.conf[prop]=false;else NAF.conf[prop]=p;break}}}}nafCleanupConf();nafCleanupConf=null;
NAF.utils={convertJSONDateToJSDate:function(iStr){var JSONDate;if(typeof iStr==="string"){JSONDate=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(iStr);if(JSONDate)return new Date(Date.UTC(+JSONDate[1],+JSONDate[2]-1,+JSONDate[3],+JSONDate[4],+JSONDate[5],+JSONDate[6]))}return JSONDate},convertLocalJSONDateToLocalJSDate:function(iStr){var JSONDate;if(typeof iStr==="string"){JSONDate=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(iStr);if(JSONDate)return new Date(+JSONDate[1],
+JSONDate[2]-1,+JSONDate[3],+JSONDate[4],+JSONDate[5],+JSONDate[6])}return JSONDate},convertJSONDateToMins:function(iStr){var jd=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(iStr);return(new Date(Date.UTC(+jd[1],+jd[2]-1,+jd[3],+jd[4],+jd[5],+jd[6]))).getTime()/6E4},convertJSONDateToJSDateCanned:function(iStr){var JSONDate;var now=new Date;if(typeof iStr==="string"){JSONDate=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(iStr);if(JSONDate)return new Date(Date.UTC(+now.getUTCFullYear(),
+now.getUTCMonth(),+now.getUTCDate(),+JSONDate[4],+JSONDate[5],+JSONDate[6]))}return JSONDate},convertJSDateToJSONDate:function(iDateTime){var month=iDateTime.getUTCMonth()+1;if(month<10)month="0"+month;var date=iDateTime.getUTCDate();if(date<10)date="0"+date;var hours=iDateTime.getUTCHours();if(hours<10)hours="0"+hours;var minutes=iDateTime.getUTCMinutes();if(minutes<10)minutes="0"+minutes;return iDateTime.getUTCFullYear()+"-"+month+"-"+date+"T"+hours+":"+minutes+":00Z"},convertYYYYMMDDToJSDate:function(iStr){var JSDate=
new Date;var data=iStr.split("-");if(data.length!=3){throw new Error("ERROR: "+iStr+" format is incorrect. Ensure the date format follows 'YYY-MM-DD'.");return null}var year=data[0];var month=parseInt(data[1],10)-1;var day=data[2];if(isNaN(year)||isNaN(month)||isNaN(day)){throw new Error("ERROR: "+iStr+" format is incorrect. Ensure the date format follows 'YYY-MM-DD'.");return}JSDate.setYear(year);JSDate.setMonth(month);JSDate.setDate(day);return JSDate},clearTimer:function(timer){if(timer){clearTimeout(timer);
timer=null}},encodeXML:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},throttle:function(func,wait){var timeout,context,args;function unblock(){timeout=null}return function(){context=this;args=arguments;if(!timeout){result=func.apply(context,args);timeout=setTimeout(unblock,wait)}}},decimalToBinary:function(num,numBits){var quotient=num;var remainder=
0;var binary=[];while(quotient>0){remainder=quotient%2;quotient=Math.floor(quotient/2);binary.unshift(remainder)}var diffLen=numBits-binary.length;if(diffLen>0)for(var i=0;i<diffLen;i++)binary.unshift(0);else if(diffLen<0)return null;return binary},copyByValue:function(obj){var newObj=obj instanceof Array?[]:new obj.constructor;for(i in obj)if(obj[i]&&obj[i]instanceof Date)newObj[i]=new Date(obj[i]);else if(obj[i]&&typeof obj[i]=="object")if(isCircularObject(obj[i]))newObj[i]=obj[i];else newObj[i]=
NAF.utils.copyByValue(obj[i]);else newObj[i]=obj[i];return newObj;function isCircularObject(node,parents){parents=parents||[];if(!node||typeof node!="object")return false;var keys=Object.keys(node),i,value;parents.push(node);for(i=keys.length-1;i>=0;i--){value=node[keys[i]];if(value&&typeof value=="object"){if(parents.indexOf(value)>=0)return true;if(isCircularObject(value,parents))return true}}parents.pop(node);return false}},cleanupProps:function(obj){if(obj)for(var property in obj)delete obj[property]},
cleanUpArray:function(list){if(list&&list.length>0){var entry=list.pop();while(entry!=undefined){NAF.utils.cleanupProps(entry);entry=list.pop()}}},compressArray:function(list){var newList=[];if(list&&list.length>0)for(var i=0;i<list.length;i++)if(list[i]!=undefined&&list[i]!=null)newList.push(list[i]);return newList},Log:function(){var enabled=false;var app="";var levels={fatal:{text:" FATAL ",rank:0},error:{text:" ERROR ",rank:1},warn:{text:" WARN  ",rank:2},debug:{text:" DEBUG ",rank:3},trace:{text:" TRACE ",
rank:4},info:{text:" INFO  ",rank:5}};var maxLevel=levels.trace;function naflog(level,param){if(enabled&&level.rank<=maxLevel.rank){var logdate=new Date;var isodate=logdate.toISOString();var thislog="NAF: "+isodate+" "+param;console.log(thislog);delete thislog;delete isodate;delete logdate}}this.trace=function(nafmesg){naflog(levels.trace,nafmesg)};this.debug=function(nafmesg){naflog(levels.debug,nafmesg)};this.info=function(nafmesg){naflog(levels.info,nafmesg)};this.warn=function(nafmesg){naflog(levels.warn,
nafmesg)};this.error=function(nafmesg){naflog(levels.error,nafmesg)};this.fatal=function(nafmesg){naflog(levels.fatal,nafmesg)};this.enable=function(){enabled=true};this.disable=function(){enabled=false};this.setAppName=function(str){app=str};this.setLevel=function(){return{fatal:function(){maxLevel=levels.fatal},error:function(){maxLevel=levels.error},warn:function(){maxLevel=levels.warn},debug:function(){maxLevel=levels.debug},trace:function(){maxLevel=levels.trace},info:function(){maxLevel=levels.info}}}();
this.getCurrLevel=function(){return maxLevel.rank}}};
NAF.Map=function(init,mediawareip){var RETRY_INTERVAL=1E4;var log=init.log;var mwip=mediawareip;var rid=1;var jsonVersion="2.0";var source;var that=this;var requestTimeout=init.requestTimeout?init.requestTimeout*1E3:0;var USER_AGE_RATING_OFF=1001;this.FACTORY_RESET_MODE={SIMPLE_RESET:0,ERASE_NAND_AND_RESET_LOCAL_SETTINGS:1,ERASE_NAND_AND_HDD_AND_RESET_LOCAL_SETTINGS:2,ERASE_NAND_AND_RESET_OPERATOR_DEFAULTS:3,ERASE_NAND_AND_HDD_AND_RESET_OPERATOR_DEFAULTS:4};var MapPlayerWindow=function(){this.type=
null;this.x=null;this.y=null;this.width=null;this.height=null};var MapPlayerParameters=function(){this.callbackParams=null;this.ver=null;this.url=null;this.block=null;this.rate=null;this.playPos=null;this.window=new MapPlayerWindow};var VidPreTuneParameters=function(){this.windowId=null;this.LocatorArray=null};var VidEnableSubtitleParameters=function(){this.enable=null};mapEmptyObject={};mapPlayerParams=new MapPlayerParameters;vidPreTuneParams=new VidPreTuneParameters;vidEnableSubtitleParams=new VidEnableSubtitleParameters;
vidBatchCommandParamsWithCmd={"commands":["GetAvailableAudioLanguages","GetAudioLanguage","GetAvailableSubtitleLanguages","GetSubtitleLanguage","IsTeletextAvailable"]};vidBatchCommandParamsWithoutCmd=["GetAvailableAudioLanguages","GetAudioLanguage","GetAvailableSubtitleLanguages","GetSubtitleLanguage","IsTeletextAvailable"];function internalHandler(event,message,error){var obj;try{obj=JSON.parse(event.data)}catch(e){log.error("server-sent event parsing failed, "+"event handler not invoked."+e);error("Invalid server-sent event");
return}if(isValidMWEvent(obj))message(obj);else{log.error("server-sent event is not a valid MW event, "+"event handler not invoked.");error("Invalid server-sent event")}function isValidMWEvent(obj){return typeof obj.method!=="undefined"}}this.SetAsyncEventHandlers=function(open,message,error){source=new EventSource("/server-sent-events");source.onopen=open;source.onmessage=function(evt){internalHandler(evt,message,error)};source.onerror=function(evt){var msg;switch(evt.target.readyState){case EventSource.CONNECTING:msg=
"Eventsource reconnecting.";break;case EventSource.CLOSED:msg="Eventsource closed. Creating a new one.";setTimeout(function(){that.SetAsyncEventHandlers(open,message,error)},RETRY_INTERVAL);break}error(msg)}};function makeRequest(){var ajax=new XMLHttpRequest;var reqObj=new Object;reqObj.method=arguments[0];reqObj.id=rid++;reqObj.jsonrpc=jsonVersion;var params=new Object;for(var i=1;i<arguments.length;i+=2){var paramName=arguments[i];var paramValue=arguments[i+1];params[paramName]=paramValue}reqObj.params=
params;var request=JSON.stringify(reqObj);var reqUrl="/ajax?"+encodeURI(request);if(typeof mwip!="undefined"&&mwip!="")reqUrl="http://"+mwip+reqUrl;log.debug("MAP-REQ: "+request);ajax.open("GET",reqUrl,false);ajax.setRequestHeader("Content-Type","application/json;charset=UTF-8");ajax.send(null);var response;try{response=JSON.parse(ajax.responseText)}catch(e){response={error:e,result:-1}}if(response.error)log.error("MAP-ERR: code="+response.error.code+" message="+response.error.message);else if(log.getCurrLevel()<=
4)log.debug("MAP-RES: status="+ajax.status+" response="+ajax.responseText.substr(0,80));else log.debug("MAP-RES: status="+ajax.status+" response="+ajax.responseText);return response.result}function asyncMakeRequest(method,params,callback){var callbackParams=params.callbackParams;delete params.callbackParams;var xhttp=new XMLHttpRequest;var reqObj=new Object;reqObj.method=method;reqObj.id=rid++;reqObj.jsonrpc=jsonVersion;if(params&&JSON.stringify(params)!="{}")reqObj.params=params;var request=JSON.stringify(reqObj);
var reqUrl="/ajax?"+encodeURI(request);if(typeof mwip!="undefined"&&mwip!="")reqUrl="http://"+mwip+reqUrl;log.debug("MAP-ASYNC-REQ: "+request);xhttp.open("GET",reqUrl,true);xhttp.setRequestHeader("Content-Type","application/json;charset=UTF-8");xhttp.onreadystatechange=function(){if(xhttp.readyState===4){if(requestTimeout>0&&xhttpTimeout==null)return;if(xhttpTimeout!=null)clearTimeout(xhttpTimeout);var response;try{if(xhttp.status==200)if(log.getCurrLevel()<=4)log.debug("MAP-ASYNC-RESPONSE: SUCCESS "+
xhttp.responseText.substr(0,200));else log.debug("MAP-ASYNC-RESPONSE: SUCCESS "+xhttp.responseText);else log.debug("MAP-ASYNC-RESPONSE: ERROR "+xhttp.responseText);response=JSON.parse(xhttp.responseText)}catch(e){response={error:e,result:-1}}if(response.error)log.error("MAP-ERR: code="+response.error.code+" message="+response.error.message);if(callback){if(response.error)response={error:response.error.message,result:-1};callback(response.result,callbackParams)}xhttpTimeout=null;xhttp.onreadystatechange=
null;response=null;callbackParams=null;xhttp=null}};xhttp.send(null);if(requestTimeout>0)var xhttpTimeout=setTimeout(function(){xhttpTimeout=null;xhttp.abort();log.debug("MAP-RES: error status = timeout. This request has timed out.");if(callback)callback(-1,callbackParams);xhttpTimeout=null;xhttp.onreadystatechange=null;response=null;callbackParams=null;xhttp=null},requestTimeout);reqObj=null;request=null;reqUrl=null}this.MapSetSplashEnabled=function(isSplash,callback,callbackParams){asyncMakeRequest("MapSetSplashEnabled",
{enable:isSplash,callbackParams:callbackParams},callback)};this.VidSetAnimationParameters=function(win,bAnim,dur,speeed,fps,callback){asyncMakeRequest("VidSetAnimationParameters",{"windowId":win,"bAnimate":bAnim,"duration":dur,"speed":speed,"fps":fps},callback)};this.VidPretune=function(win,aLocators,callback){vidPreTuneParams.windowId=win;vidPreTuneParams.LocatorArray=aLocators;asyncMakeRequest("VidPreTune",vidPreTuneParams,callback)};this.VidStopPretune=function(win,aLocators,callback){asyncMakeRequest("VidStopPreTune",
{"windowId":win},callback)};this.VidGetCurChan=function(callback){asyncMakeRequest("VidGetCurChan",mapEmptyObject,callback)};this.VidGetLastChan=function(callback){asyncMakeRequest("VidGetLastChan",mapEmptyObject,callback)};this.VidSetLastViewedChan=function(chanId,callback){asyncMakeRequest("MapSetLastChan",{"id":chanId},callback)};this.VidGetStartChan=function(){return null};this.VidDetune=function(callback){asyncMakeRequest("VidDetune",mapEmptyObject,callback)};this.VidGetChanCount=function(callback){asyncMakeRequest("VidGetChanCount",
mapEmptyObject,callback)};this.VidGetChannelList=function(platform,callback){asyncMakeRequest("VidGetChannelList",{"platform":platform},callback)};this.VidSetVideoWinSize=function(x,y,w,h,bPIP,callback){asyncMakeRequest("VidSetVideoWinSize",{"x":x,"y":y,"w":w,"h":h,"bPIP":bPIP},callback)};this.VidGetStreamComponents=function(callback){if(callback)asyncMakeRequest("VidBatchCommand",vidBatchCommandParamsWithCmd,callback);else return makeRequest("VidBatchCommand","commands",vidBatchCommandParamsWithoutCmd)};
this.VidEnableCC=function(bEnable,callback){asyncMakeRequest("VidSetCloseCap",{"enable":bEnable},callback)};this.VidGetAvailableAudioLang=function(callback){asyncMakeRequest("GetAvailableAudioLanguages",mapEmptyObject,callback)};this.VidSetPrefAudioLang=function(lang,type,callback,callbackParams){var params=new Object;params["language"]=lang;if(type||type!="")params["type"]=type;params.callbackParams=callbackParams;asyncMakeRequest("SetAudioLanguagePreference",params,callback)};this.VidGetPrefAudioLang=
function(callback){asyncMakeRequest("GetAudioLanguagePreference",mapEmptyObject,callback)};this.VidSetAudioLang=function(lang,callback,callbackParams){var params=new Object;params["language"]=lang;params.callbackParams=callbackParams;asyncMakeRequest("SetAudioLanguage",params,callback)};this.VidGetAudioLang=function(callback){asyncMakeRequest("GetAudioLanguage",mapEmptyObject,callback)};this.VidSetResolution=function(port,res,callback){asyncMakeRequest("VidSetResolution",{"port":port,"resolution":res},
callback)};this.VidGetAvailableSubtitleLang=function(callback){asyncMakeRequest("GetAvailableSubtitleLanguages",mapEmptyObject,callback)};this.VidSetPrefSubtitleLang=function(langs,type,callback,callbackParams){var params=new Object;params["language"]=langs;params["type"]=type;params.callbackParams=callbackParams;asyncMakeRequest("SetSubtitleLanguagePreference",params,callback)};this.VidGetPrefSubtitleLang=function(callback){asyncMakeRequest("GetSubtitleLanguagePreference",mapEmptyObject,callback)};
this.VidGetSubtitleAvailability=function(callback){asyncMakeRequest("GetSubtitleAvailability",mapEmptyObject,callback)};this.VidEnableSubtitle=function(bo,callback){vidEnableSubtitleParams.enable=bo;asyncMakeRequest("EnableSubtitle",vidEnableSubtitleParams,callback)};this.VidSetSubtitleLang=function(langs,callback,callbackParams){var params=new Object;params["language"]=langs;params.callbackParams=callbackParams;asyncMakeRequest("SetSubtitleLanguage",params,callback)};this.VidGetSubtitleLang=function(callback){asyncMakeRequest("GetSubtitleLanguage",
mapEmptyObject,callback)};this.IsSubtitleEnabled=function(callback){asyncMakeRequest("IsSubtitleEnabled",mapEmptyObject,callback)};this.VidSetPrefTeletextLang=function(lang,type,callback,callbackParams){log.warn("VidSetPrefTeletextLang(): Not yet supported.");return};this.VidGetPrefTeletextLang=function(callback){log.warn("VidGetPrefTeletextLang(): Not yet supported.");return};this.IsTeletextEnabled=function(callback){asyncMakeRequest("IsTeletextEnabled",mapEmptyObject,callback)};this.EnableTeletext=
function(enable,callback){asyncMakeRequest("EnableTeletext",{"enable":enable},callback)};this.IsTeletextAvailable=function(callback){asyncMakeRequest("IsTeletextAvailable",mapEmptyObject,callback)};this.VidSetTeletextLang=function(lang,type,callback,callbackParams){log.warn("VidSetTeletextLang(): Not yet supported.");return};this.VidGetTeletextLang=function(callback){log.warn("VidGetTeletextLang(): Not yet supported.");return};this.VidSpeakerMute=function(isBlocked,callback){asyncMakeRequest("VidSpeakerMute",
{"flag":isBlocked},callback)};this.VidDisplayVideoOn=function(isBlocked,callback){asyncMakeRequest("VidDisplayVideoOn",{"flag":isBlocked},callback)};this.DlnaSetDeviceName=function(name,type,callback){if(callback)asyncMakeRequest("MapDLNASetDeviceName",{"name":name,"type":type},callback);else return makeRequest("MapDLNASetDeviceName","name",name,"type",type)};this.DlnaGetDeviceName=function(type,callback){if(callback)asyncMakeRequest("MapDLNAGetDeviceName",{"type":type},callback);else return makeRequest("MapDLNAGetDeviceName",
"type",type)};this.MapDLNAGetActiveDevices=function(params,callback){if(callback)asyncMakeRequest("MapDLNAGetActiveDevices",{"type":params},callback);else return makeRequest("MapDLNAGetActiveDevices","type",params)};this.MapDLNAGetContainer=function(devid,containerId,containerType,filter,start,count,sort,callback){if(callback)asyncMakeRequest("MapDLNAGetContainer",{"id":devid,"containerId":containerId,"containerType":containerType,"filter":filter,"startAt":start,"requestedCount":count,"sort":sort},
callback);else return makeRequest("MapDLNAGetContainer","id",devid,"containerId",containerId,"containerType",containerType,"filter",filter,"startAt",start,"requestedCount",count,"sort",sort)};this.MapPlayer=function(url,block,rate,position,winType,x,y,w,h,callback,callbackParams){if(callbackParams)mapPlayerParams.callbackParams=callbackParams;else mapPlayerParams.callbackParams=undefined;mapPlayerParams.ver="1.0";if(url)mapPlayerParams.url=url;else mapPlayerParams.url=undefined;mapPlayerParams.block=
block;mapPlayerParams.rate=rate;if(position)mapPlayerParams.playPos=position;else mapPlayerParams.playPos=undefined;mapPlayerParams.window.type=winType;mapPlayerParams.window.x=x;mapPlayerParams.window.y=y;mapPlayerParams.window.width=w;mapPlayerParams.window.height=h;asyncMakeRequest("MapPlayer",mapPlayerParams,callback)};this.MapPlayerRTSPVod=function(assetId,block,rate,position,winType,x,y,w,h,callback,callbackParams){var playerWindow=new Object;playerWindow.type=winType;playerWindow.x=x;playerWindow.y=
y;playerWindow.width=w;playerWindow.height=h;var params=new Object;params["ver"]="1.0";if(assetId)params["id"]=assetId;params["block"]=block;params["rate"]=rate;if(position!=undefined&&position!=null&&position!=="")if(position>=0)params["playPos"]=position*1E3;else if(position==-1)params["playPos"]=-1;params["window"]=playerWindow;if(callbackParams)params.callbackParams=callbackParams;asyncMakeRequest("MapPlayer",params,callback);playerWindow=null;params=null};this.MapPlayerStop=function(winType,
x,y,w,h,callback){var playerWindow=new Object;playerWindow.type=winType;asyncMakeRequest("MapPlayer",{"ver":"1.0","window":playerWindow},callback);playerWindow=null};this.MapPlayerSkip=function(url,rate,offset,winType,x,y,w,h,callback,callbackParams,block){var playerWindow=new Object;playerWindow.type=winType;playerWindow.x=x;playerWindow.y=y;playerWindow.width=w;playerWindow.height=h;var params={"ver":"1.0","url":url,"rate":rate,"skip":offset,"window":playerWindow};if(callbackParams)params.callbackParams=
callbackParams;if(block!==undefined&&block!==null)params.block=block;asyncMakeRequest("MapPlayer",params,callback);playerWindow=null};this.MapPlayerMakePipPrimary=function(pipUrl,callback){var params=new Object;params["ver"]="1.0";params["url"]=pipUrl;params["window"]={type:"pip"};params["destwin"]={type:"main"};asyncMakeRequest("MapPlayer",params,callback)};this.MapPlayerSetVideoWinSize=function(url,winType,x,y,w,h,callback){var playerWindow=new Object;playerWindow.type=winType;playerWindow.x=x;
playerWindow.y=y;playerWindow.width=w;playerWindow.height=h;asyncMakeRequest("MapPlayer",{"ver":"1.0","url":url,"window":playerWindow},callback)};this.DvrGetCheckPoint=function(callback){if(callback)asyncMakeRequest("PvrGetCheckPoint",mapEmptyObject,callback);else return makeRequest("PvrGetCheckPoint")};this.DvrSync=function(callback){if(callback)asyncMakeRequest("PvrSync",mapEmptyObject,callback);else return makeRequest("PvrSync")};this.DvrRecord=function(loc,channelId,secs,t,d,start,repeat,fPad,
bPad,locked,callback){var params=new Object;params["locator"]=loc;params["channelId"]=channelId;params["duration"]=secs;params["title"]=t;params["description"]=d;params["start"]=start;params["isPinLocked"]=locked;if(fPad)params["frontPad"]=fPad;if(bPad)params["backPad"]=bPad;var crontabInterval;if(repeat!=0){var recordingDate;if(!start)recordingDate=new Date;else recordingDate=new Date(start*1E3);var repeatDays="";for(var i=0;i<repeat.length;i++)if(repeat[i]==7)repeatDays="0,"+repeatDays;else repeatDays+=
repeat[i]+",";repeatDays=repeatDays.substring(0,repeatDays.length-1);crontabInterval=recordingDate.getMinutes()+" "+recordingDate.getUTCHours()+" * * "+repeatDays}if(crontabInterval)params["interval"]=crontabInterval;asyncMakeRequest("PvrSchedRecording",params,callback);params=null};this.DvrRecordEvent=function(eId,fPad,bPad,locked,callback){log.trace("DvrRecordEvent: "+eId);var params=new Object;params["eventCrid"]=eId;params["isPinLocked"]=locked;if(fPad||fPad===0)params["frontPad"]=fPad;if(bPad||
bPad===0)params["backPad"]=bPad;asyncMakeRequest("PvrSchedRecording",params,callback);params=null};this.DvrRecordSeries=function(sId,fPad,bPad,chan,event,locked,callback){log.trace("DvrRecordSeries: "+sId+" chan: "+chan+" event: "+event);var params=new Object;params["seriesCrid"]=sId;params["isPinLocked"]=locked;if(fPad!=null)params["frontPad"]=fPad;if(bPad!=null)params["backPad"]=bPad;if(chan)params["channel"]=chan;if(event)params["event"]=event;asyncMakeRequest("PvrSchedRecording",params,callback);
params=null};this.DvrUpdateRecord=function(id,duration,startTime,callback){if(duration!=undefined&&startTime!=undefined)if(callback)asyncMakeRequest("PvrUpdateRecording",{"recordingId":id,"duration":duration,"start":startTime},callback);else return makeRequest("PvrUpdateRecording","recordingId",id,"duration",duration,"start",startTime);else if(startTime!=undefined){log.warn("DvrUpdateRecord(): duration is null!!!");if(callback)asyncMakeRequest("PvrUpdateRecording",{"recordingId":id,"start":startTime},
callback);else return makeRequest("PvrUpdateRecording","recordingId",id,"start",startTime)}else if(duration!=undefined){log.warn("DvrUpdateRecord(): startTime is null!!!");if(callback)asyncMakeRequest("PvrUpdateRecording",{"recordingId":id,"duration":duration},callback);else return makeRequest("PvrUpdateRecording","recordingId",id,"duration",duration)}};this.DvrUpdateOperation=function(id,fPad,bPad,locked,callback){var params=new Object;params["operationId"]=id;if(fPad)params["frontPad"]=fPad;if(bPad)params["backPad"]=
bPad;if(locked!=undefined)params["isPinLocked"]=locked;asyncMakeRequest("MapPvrUpdateOperation",params,callback);params=null};this.DvrSetBookmark=function(recordingId,bookmark,callback){asyncMakeRequest("PvrSetBookmark",{"recordingId":recordingId,"position":bookmark},callback)};this.DvrSetViewState=function(recordingId,viewState,callback){asyncMakeRequest("PvrSetViewState",{"recordingId":recordingId,"ViewState":viewState},callback)};this.DvrAssetList=function(callback){asyncMakeRequest("PvrListRecording",
mapEmptyObject,callback)};this.DvrListRequests=function(callback){if(callback)asyncMakeRequest("PvrListRequests",mapEmptyObject,callback);else return makeRequest("PvrListRequests")};this.DvrListOperations=function(callback){if(callback)asyncMakeRequest("PvrListOperations",mapEmptyObject,callback);else return makeRequest("PvrListOperations")};this.DvrListRecordings=function(callback){if(callback)asyncMakeRequest("PvrListRecordings",mapEmptyObject,callback);else return makeRequest("PvrListRecordings")};
this.DvrListRequestsOperationsRecordings=function(callback){if(callback)asyncMakeRequest("PvrBatchCommand",{"commands":["PvrListRequests","PvrListOperations","PvrListRecordings"]},callback);else return makeRequest("PvrBatchCommand","commands",["PvrListRequests","PvrListOperations","PvrListRecordings"])};this.DvrGetRecords=function(cp,callback){if(callback)asyncMakeRequest("MapPvrGetRecords",{"checkPoint":cp},callback);else return makeRequest("MapPvrGetRecords","checkPoint",cp)};this.DvrGetRecordingInfo=
function(id,callback){if(callback)asyncMakeRequest("PvrGetRecordingInfo",{"recordingId":id},callback);else return makeRequest("PvrGetRecordingInfo","recordingId",id)};this.DvrGetConflicts=function(id,callback,callbackParams){var params=new Object;params={"opId":id};params.callbackParams=callbackParams;asyncMakeRequest("MapPvrGetConflicts",params,callback)};this.DvrResolve=function(id,callback){asyncMakeRequest("MapPvrResolve",{"operationId":id},callback)};this.DvrPause=function(callback){asyncMakeRequest("PvrPlayTrick",
{"speed":0},callback)};this.DvrResume=function(callback){asyncMakeRequest("PvrPlayTrick",{"speed":100},callback)};this.DvrFastForward=function(speed,callback){asyncMakeRequest("PvrPlayTrick",{"speed":speed},callback)};this.DvrRewind=function(speed,callback){asyncMakeRequest("PvrPlayTrick",{"speed":-speed},callback)};this.DvrOffset=function(offset,callback){asyncMakeRequest("PvrPlaySkip",{"offset":offset},callback)};this.DvrDelete=function(loc,callback){asyncMakeRequest("PvrDeleteRecording",{"locator":loc},
callback)};this.DvrDeleteAll=function(callback){asyncMakeRequest("PvrDeleteAll",mapEmptyObject,callback)};this.DvrDeleteRequest=function(id,callback){asyncMakeRequest("PvrDelete",{"requestId":id},callback)};this.DvrDeleteOperation=function(id,callback){asyncMakeRequest("PvrDelete",{"operationId":id},callback)};this.DvrDeleteOperations=function(ids,callback){var command={};command["operationIds"]=ids;asyncMakeRequest("PvrDelete",command,callback)};this.DvrDeleteRecording=function(id,callback){asyncMakeRequest("PvrDelete",
{"recordingId":id},callback)};this.DvrCancelRequest=function(id,callback){asyncMakeRequest("PvrCancel",{"requestId":id},callback)};this.DvrDeleteProtectOperation=function(id,state,callback,callbackParams){var params=new Object;params={"operationId":id,"protect":state};params.callbackParams=callbackParams;asyncMakeRequest("PvrDeleteProtect",params,callback)};this.DvrDeleteProtectOperations=function(ids,state,callback,callbackParams){var params=new Object;params={"operationIds":ids,"protect":state};
params.callbackParams=callbackParams;asyncMakeRequest("PvrDeleteProtect",params,callback)};this.DvrDeleteProtectRequest=function(id,state,callback,callbackParams){var params=new Object;params={"requestId":id,"protect":state};params.callbackParams=callbackParams;asyncMakeRequest("PvrDeleteProtect",params,callback)};this.DvrPinProtectOperation=function(id,state,callback,callbackParams){var params=new Object;params={"operationId":id,"protect":state};params.callbackParams=callbackParams;asyncMakeRequest("PvrPinProtect",
params,callback)};this.DvrPinProtectOperations=function(ids,state,callback,callbackParams){var params=new Object;params={"operationIds":ids,"protect":state};params.callbackParams=callbackParams;asyncMakeRequest("PvrPinProtect",params,callback)};this.DvrPinProtectRequest=function(id,state,callback,callbackParams){var params=new Object;params={"requestId":id,"protect":state};params.callbackParams=callbackParams;asyncMakeRequest("PvrPinProtect",params,callback)};this.DvrStop=function(callback){asyncMakeRequest("DvrStop",
mapEmptyObject,callback)};this.PvrStop=function(callback){asyncMakeRequest("PvrStop",mapEmptyObject,callback)};this.DvrStopRecording=function(id,callback){asyncMakeRequest("PvrStopRecording",{"recordingId":id},callback)};this.VodSessionOpen=function(aid,typ,callback){asyncMakeRequest("VodSessionOpen",{"assetId":aid,"vodType":typ},callback)};this.VodSessionClose=function(callback){asyncMakeRequest("VodSessionClose",mapEmptyObject,callback)};this.VodPlay=function(blocked,start,callback){asyncMakeRequest("VodPlay",
{"blocked":blocked,"start":start},callback)};this.VodPause=function(callback){asyncMakeRequest("VodPause",mapEmptyObject,callback)};this.VodFastforward=function(num,denom,callback){asyncMakeRequest("VodFastforward",{"numerator":num,"denominator":denom},callback)};this.VodRewind=function(num,denom,callback){asyncMakeRequest("VodRewind",{"numerator":num,"denominator":denom},callback)};this.VodStop=function(callback){asyncMakeRequest("VodStop",mapEmptyObject,callback)};this.VodGet=function(nam,callback){asyncMakeRequest("VodGet",
{"name":nam},callback)};this.VodSet=function(nam,val,callback){asyncMakeRequest("VodSet",{"name":nam,"value":val},callback)};this.VodPlaySkip=function(offset,callback){asyncMakeRequest("VodPlaySkip",{"offset":offset},callback)};this.VodResume=function(callback){asyncMakeRequest("VodFastforward",{"numerator":1,"denominator":1},callback)};this.ConfigGet=function(nm,callback,callbackParams){var params=new Object;params={"name":nm};if(callbackParams)params.callbackParams=callbackParams;asyncMakeRequest("ConfigGet",
params,callback)};this.ConfigsGet=function(nmArray,callback,callbackParams){var params=new Object;params={"name":nmArray};if(callbackParams)params.callbackParams=callbackParams;asyncMakeRequest("ConfigGet",params,callback)};this.ConfigSet=function(nm,val,callback){if(callback)asyncMakeRequest("ConfigSet",{"name":nm,"value":val},callback);else return makeRequest("ConfigSet","name",nm,"value",val)};this.GetMWConfig=function(section,key,callback){asyncMakeRequest("GetMWConfig",{"section":section,"key":key},
callback)};this.GetKeyMap=function(callback){asyncMakeRequest("GetKeyMap",mapEmptyObject,callback)};this.EmulateRemoteKey=function(kc,ks){if(!!ks)asyncMakeRequest("EmulateRemoteKey",{"KeyCode":kc,"KeyState":ks});else asyncMakeRequest("EmulateRemoteKey",{"KeyCode":kc})};this.VerifyPin=function(profId,type,pin,callback,callbackParams){var params=new Object;params={"profile":profId,"type":type,"pin":pin};params.callbackParams=callbackParams;asyncMakeRequest("VerifyPin",params,callback)};this.ResetPin=
function(profId,type,pin,newpin,callback,callbackParams){var params=new Object;params={"profile":profId,"type":type,"masterpin":pin,"newpin":newpin};params.callbackParams=callbackParams;asyncMakeRequest("ResetPin",params,callback)};this.GetPinState=function(profId,type){asyncMakeRequest("GetPinState",{"profile":profId,"type":type},callback)};this.ActivatePin=function(profId,type,pin,enable){asyncMakeRequest("ActivatePin",{"profile":profId,"type":type,"masterpin":masterpin,"activate":enable},callback)};
this.GetProfileNames=function(callback,callbackParams){callback()};this.GetProfileSettings=function(profileid,settings,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=settings;asyncMakeRequest("ReadProfile",params,callback)};this.SetProfileSettings=function(profileid,settings,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;
if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=settings;asyncMakeRequest("WriteProfile",params,callback)};this.ProfileSetInitChan=function(profileid,newInitChan,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.initChannel=newInitChan;asyncMakeRequest("WriteProfile",params,callback)};
this.ProfileGetInitChan=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=["initChannel"];asyncMakeRequest("ReadProfile",params,callback)};this.ProfileSetAgeRating=function(profileid,newAgeRating,callback,callbackParams){newAgeRating=newAgeRating?newAgeRating:USER_AGE_RATING_OFF;var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=
-1)params.keyword="master";params.Settings=new Object;params.Settings.ageRating=newAgeRating;asyncMakeRequest("WriteProfile",params,callback)};this.ProfileGetAgeRating=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=["ageRating"];asyncMakeRequest("ReadProfile",params,callback)};this.ProfileSetStartupProtection=function(profileid,newStartupProtection,callback,callbackParams){var params=
new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.startupProtection=newStartupProtection;asyncMakeRequest("WriteProfile",params,callback)};this.ProfileGetStartupProtection=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=["startupProtection"];
asyncMakeRequest("ReadProfile",params,callback)};this.ProfileSetNeedPinForPurchase=function(profileid,newNeedPinForPurchase,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.needPinForPurchase=newNeedPinForPurchase;asyncMakeRequest("WriteProfile",params,callback)};this.ProfileGetNeedPinForPurchase=function(profileid,
callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=["needPinForPurchase"];asyncMakeRequest("ReadProfile",params,callback)};this.SetStandbyMode=function(mode,timeout,time,callback,callbackParams){asyncMakeRequest("SetStandbyMode",{"mode":mode,"timeout":timeout,"time":time,"callbackParams":callbackParams},callback)};this.AcknowledgePowerManagerEvent=function(callback){asyncMakeRequest("AcknowledgePowerManagerEvent",
mapEmptyObject,callback)};this.PesGetAllEvents=function(filter,callback){if(callback)asyncMakeRequest("GetAllEvents",{"filter":filter},callback);else return makeRequest("PesGetAllEvents","filter",filter)};this.PesGetChannelsWithEvent=function(chanFilter,chanProps,eventFilter,callback,callbackParams){asyncMakeRequest("GetChannelsWithEvent",{"ChanFilter":chanFilter,"ChanProps":chanProps,"EventFilter":eventFilter,"callbackParams":callbackParams},callback)};this.PesGetEventsByChanId=function(chanId,filter,
callback){if(callback)asyncMakeRequest("GetEventsByChanId",{"chanId":chanId,"filter":filter},callback);else return makeRequest("GetEventsByChanId","chanId",chanId,"filter",filter)};this.PesGetEventsByLcn=function(lcn,filter,callback){if(callback)asyncMakeRequest("GetEventsByLcn",{"lcn":lcn,"filter":filter},callback);else return makeRequest("GetEventsByLcn","lcn",lcn,"filter",filter)};this.PesGetPfEventsByChanId=function(chanId){return makeRequest("GetPfEventsByChanId","chanId",chanId)};this.PesGetPfEventsByLcn=
function(lcn){return makeRequest("GetPfEventsByLcn","lcn",lcn)};this.MapGetOnlineMode=function(callback,checkNow){if(callback){var params=checkNow?{"checkNow":true}:{};asyncMakeRequest("MapGetOnlineMode",params,callback)}else return makeRequest("MapGetOnlineMode")};this.writePVRProfile=function(profileid,pvrSettings,callback,callbackParams){var params=new Object;params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=
new Object;params.Settings.pvrSettings=new Object;params.Settings.pvrSettings.frontPad=pvrSettings.newFrontPad!=undefined?pvrSettings.newFrontPad:pvrSettings.frontPad;params.Settings.pvrSettings.backPad=pvrSettings.newBackPad!=undefined?pvrSettings.newBackPad:pvrSettings.backPad;params.Settings.pvrSettings.seriesDomain=pvrSettings.newSeriesDomain!=undefined?pvrSettings.newSeriesDomain:pvrSettings.seriesDomain;params.Settings.pvrSettings.diskManagement=pvrSettings.newDiskManagement!=undefined?pvrSettings.newDiskManagement:
pvrSettings.diskManagement;asyncMakeRequest("WriteProfile",params,callback)};this.readPVRProfile=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=["pvrSettings"];asyncMakeRequest("ReadProfile",params,callback)};this.writeViewSettingsProfile=function(profileid,langSettings,viewSettings,callback,callbackParams){var params=
new Object;params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.viewSettings=new Object;params.Settings.viewSettings.lang=new Object;params.Settings.viewSettings.lang.code=langSettings.newCode!=undefined?langSettings.newCode:langSettings.code;params.Settings.viewSettings.lang.type=langSettings.newType!=undefined?langSettings.newType:langSettings.type;params.Settings.viewSettings.transparency=
viewSettings.newTransparency!=undefined?viewSettings.newTransparency:viewSettings.transparency;params.Settings.viewSettings.bannerTimeout=viewSettings.newBannerTimeout!=undefined?viewSettings.newBannerTimeout:viewSettings.bannerTimeout;params.Settings.viewSettings.epgStyle=viewSettings.newEpgStyle!=undefined?viewSettings.newEpgStyle:viewSettings.epgStyle;params.Settings.viewSettings.epgSpan=viewSettings.newEpgSpan!=undefined?viewSettings.newEpgSpan:viewSettings.epgSpan;params.Settings.viewSettings.assetsStyle=
viewSettings.newAssetsStyle!=undefined?viewSettings.newAssetsStyle:viewSettings.assetsStyle;params.Settings.viewSettings.settingsProtection=viewSettings.newSettingsProtection!=undefined?viewSettings.newSettingsProtection:viewSettings.settingsProtection;asyncMakeRequest("WriteProfile",params,callback)};this.readViewSettingsProfile=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=
-1)params.keyword="master";params.Settings=["viewSettings"];asyncMakeRequest("ReadProfile",params,callback)};this.writeOutputSettingsProfile=function(profileid,outputSettings,callback,callbackParams){var params=new Object;params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.outputSettings=new Object;params.Settings.outputSettings.primary=outputSettings.newPrimary!=undefined?outputSettings.newPrimary:
outputSettings.primary;params.Settings.outputSettings.hdmi=new Object;params.Settings.outputSettings.hdmi.resolution=outputSettings.hdmi.newResolution!=undefined?outputSettings.hdmi.newResolution:outputSettings.hdmi.resolution;params.Settings.outputSettings.hdmi.format=outputSettings.hdmi.newFormat!=undefined?outputSettings.hdmi.newFormat:outputSettings.hdmi.format;params.Settings.outputSettings.hdmi.color=outputSettings.hdmi.newColor!=undefined?outputSettings.hdmi.newColor:outputSettings.hdmi.color;
params.Settings.outputSettings.hdmi.audio=new Object;params.Settings.outputSettings.hdmi.audio.enable=outputSettings.hdmi.audio.newEnable!=undefined?outputSettings.hdmi.audio.newEnable:outputSettings.hdmi.audio.enable;params.Settings.outputSettings.hdmi.audio.delay=outputSettings.hdmi.audio.newDelay!=undefined?outputSettings.hdmi.audio.newDelay:outputSettings.hdmi.audio.delay;params.Settings.outputSettings.spdif=new Object;params.Settings.outputSettings.spdif.enable=outputSettings.spdif.newEnable!=
undefined?outputSettings.spdif.newEnable:outputSettings.spdif.enable;params.Settings.outputSettings.spdif.delay=outputSettings.spdif.newDelay!=undefined?outputSettings.spdif.newDelay:outputSettings.spdif.delay;params.Settings.outputSettings.tv=new Object;params.Settings.outputSettings.tv.aspectRatio=outputSettings.tv.newAspectRatio!=undefined?outputSettings.tv.newAspectRatio:outputSettings.tv.aspectRatio;params.Settings.outputSettings.tv.start=outputSettings.tv.newStart!=undefined?outputSettings.tv.newStart:
outputSettings.tv.start;params.Settings.outputSettings.scart=new Object;params.Settings.outputSettings.scart.format=outputSettings.scart.newFormat!=undefined?outputSettings.scart.newFormat:outputSettings.scart.format;params.Settings.outputSettings.scart.color=outputSettings.scart.newColor!=undefined?outputSettings.scart.newColor:outputSettings.scart.color;params.Settings.outputSettings.scart.enable=outputSettings.scart.newEnable!=undefined?outputSettings.scart.newEnable:outputSettings.scart.enable;
params.Settings.outputSettings.audio=new Object;params.Settings.outputSettings.audio.format=outputSettings.audio.newFormat!=undefined?outputSettings.audio.newFormat:outputSettings.audio.format;params.Settings.outputSettings.frontPanel=new Object;params.Settings.outputSettings.frontPanel.luminosity=outputSettings.frontPanel.newLuminosity!=undefined?outputSettings.frontPanel.newLuminosity:outputSettings.frontPanel.luminosity;asyncMakeRequest("WriteProfile",params,callback)};this.readOutputSettingsProfile=
function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=["outputSettings"];asyncMakeRequest("ReadProfile",params,callback)};this.SetVideoOutputSettings=function(resolution,type,callback,callbackParams){resolution=NAF.conf.hdmiComponent[resolution];var params=new Object;params.id=resolution;if(type)params.type=type;params.callbackParams=
callbackParams;asyncMakeRequest("MapSetVideoOutputPortSettings",params,callback)};this.GetVideoOutputSettings=function(resolution,callback){params=new Object;if(resolution)params.type=resolution;asyncMakeRequest("MapGetVideoOutputPortSettings",params,callback)};this.SetPortControlSettings=function(aspectRatio,fastBlank,callback,callbackParams){var params=new Object;params.type="scart";if(aspectRatio)params.aspectRatio=aspectRatio;if(fastBlank)params.fastBlank=fastBlank;params.callbackParams=callbackParams;
asyncMakeRequest("MapSetVideoPortControlSettings",params,callback)};this.MapGetDolbyEnabled=function(callback){asyncMakeRequest("MapGetDolbyEnabled",mapEmptyObject,callback)};this.MapSetDolbyEnabled=function(isDolby,callback,callbackParams){asyncMakeRequest("MapSetDolbyEnabled",{enable:isDolby,callbackParams:callbackParams},callback)};this.SetAudioOutputSettings=function(format,type,callback,callbackParams){var params=new Object;params.id=format;if(type)params.type=type;params.callbackParams=callbackParams;
asyncMakeRequest("MapSetAudioOutputPortSettings",params,callback)};this.GetAudioOutputSettings=function(format,callback){params=new Object;if(format)params.type=format;asyncMakeRequest("MapGetAudioOutputPortSettings",params,callback)};this.SetAudioControlSettings=function(params,callback,callbackParams){if(callbackParams)params.callbackParams=callbackParams;asyncMakeRequest("MapSetAudioControlSettings",params,callback)};this.GetAudioControlSettings=function(type,callback,callbackParams){var params=
new Object;if(callbackParams)params.callbackParams=callbackParams;if(type)params.type=type;asyncMakeRequest("MapGetAudioControlSettings",params,callback)};this.GetHDDAvailability=function(callback){asyncMakeRequest("MapGetHDDAvailability",mapEmptyObject,callback)};this.MapGetSystemStatus=function(callback){asyncMakeRequest("MapGetSystemStatus",mapEmptyObject,callback)};this.VidGetTSBInfo=function(callback){asyncMakeRequest("GetTSBInfo",mapEmptyObject,callback)};this.VidGetTSBEventInfo=function(callback){asyncMakeRequest("GetTSBEventInfo",
mapEmptyObject,callback)};this.SubscribePlayerPosition=function(frequency,callback){asyncMakeRequest("MAPSubscribeEvent",{"name":"MWPlayerPosition","frequency":frequency},callback)};this.UnsubscribePlayerPosition=function(callback){asyncMakeRequest("MAPUnsubscribeEvent",{"name":"MWPlayerPosition"},callback)};this.SubscribeTSBEventInfo=function(callback){asyncMakeRequest("MAPSubscribeEvent",{"name":"TSBEventInfo"},callback)};this.UnsubscribeTSBEventInfo=function(callback){asyncMakeRequest("MAPUnsubscribeEvent",
{"name":"TSBEventInfo"},callback)};this.AdjustUserAgeRating=function(ageRating,callback){asyncMakeRequest("AdjustUserAgeRating",{"tempAgeRating":ageRating},callback)};this.RevertUserAgeRating=function(callback){asyncMakeRequest("RevertUserAgeRating",mapEmptyObject,callback)};this.GetDiagnostics=function(callback){asyncMakeRequest("GetDiagnostics",mapEmptyObject,function(result){if(callback)callback(GetDiagnosticsCB(result))})};this.DiagnosticsGetHDMIStatus=function(callback){asyncMakeRequest("MapGetVideoPortControlSettings",
mapEmptyObject,callback)};this.SendDiagMsg=function(result,targetIp,msg,callback){if(callback)asyncMakeRequest("SendTo",{"method":"DiagResult","targetIP":targetIp,"result":result,"message":msg},callback);else return makeRequest("SendTo","method","DiagResult","targetIP",targetIp,"result",result,"message",msg)};this.SendDiagResp=function(result,targetIp,msg,dqId,callback){if(callback)asyncMakeRequest("QueryResult",{"method":"DiagResult","targetIP":targetIp,"result":result,"message":msg,"dqId":dqId},
callback);else return makeRequest("QueryResult","method","DiagResult","targetIP",targetIp,"result",result,"message",msg,"dqId",dqId)};this.SetDefaultStandbyMode=function(profileid,defaultStandby,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.Settings=new Object;params.Settings.defaultStandby=defaultStandby;asyncMakeRequest("WriteProfile",params,
callback)};this.GetDefaultStandbyMode=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;params.profileId=profileid;params.Settings=["defaultStandby"];asyncMakeRequest("ReadProfile",params,callback)};this.GetStandbyModeSettings=function(callback){asyncMakeRequest("GetStandbyModeSettings",mapEmptyObject,callback)};this.SetStandbyModeSettings=function(type,timeOut,startTime,endTime,weekDay,callback,callbackParams){var params=new Object;
params={"autoStandby":type,"timeout":timeOut,"startTime":startTime,"endTime":endTime,"weekday":weekDay};if(callbackParams)params.callbackParams=callbackParams;asyncMakeRequest("SetStandbyModeSettings",params,callback)};this.GetNetworks=function(callback){callback()};this.HideSplashScreen=function(){return};this.writePrefAudioLangs=function(profileid,prefAudioLangs,callback){var params=new Object;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=
new Object;params.Settings.prefAudioLangs=prefAudioLangs;asyncMakeRequest("WriteProfile",params,callback)};this.readPrefAudioLangs=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=["prefAudioLangs"];asyncMakeRequest("ReadProfile",params,callback)};this.writePrefSubtitleLangs=function(profileid,prefSubtitleLangs,callback){var params=
new Object;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=new Object;params.Settings.prefSubtitleLangs=prefSubtitleLangs;asyncMakeRequest("WriteProfile",params,callback)};this.readPrefSubtitleLangs=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=callbackParams;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=["prefSubtitleLangs"];
asyncMakeRequest("ReadProfile",params,callback)};this.writePrefTeletextLangs=function(profileid,prefTeletextLangs,callback){var params=new Object;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=new Object;params.Settings.prefTeletextLangs=prefTeletextLangs;asyncMakeRequest("WriteProfile",params,callback)};this.readPrefTeletextLangs=function(profileid,callback,callbackParams){var params=new Object;if(callbackParams)params.callbackParams=
callbackParams;if(profileid.indexOf("MasterProfile")!=-1)params.keyword="master";params.profileId=profileid;params.Settings=["prefTeletextLangs"];asyncMakeRequest("ReadProfile",params,callback)};function GetDiagnosticsCB(result){if(result){var diagResult=new Object;diagResult.hw=new Object;diagResult.hw.hdd=new Object;diagResult.hw.tuners=new Array;if(result.hw){diagResult.hw.hdd.available=result.hw.hdd.available;diagResult.hw.hdd.capacity=result.hw.hdd.capacity;diagResult.hw.hdd.temperature=result.hw.hdd.temperature;
diagResult.hw.version=result.hw.version;diagResult.hw.interfaces=result.hw.interfaces!=null?result.hw.interfaces:"";diagResult.hw.cm=result.hw.cm!=null?result.hw.cm:"";for(var i=0;i<result.hw.tuners.length;i++)diagResult.hw.tuners.push(result.hw.tuners[i])}diagResult.ioports=new Object;diagResult.ioports.hdmi=new Object;if(result.ioports){diagResult.ioports.hdmi.hdcpStatus=result.ioports.hdmi.hdcpStatus;diagResult.ioports.hdmi.status=result.ioports.hdmi.status;diagResult.ioports.hdmi.tvEdid=result.ioports.hdmi.tvEdid}diagResult.ca=
new Object;if(result.ca){diagResult.ca.caCallback=result.ca.caCallback;diagResult.ca.ecmReception=result.ca.ecmReception;diagResult.ca.emmReception=result.ca.emmReception;diagResult.ca.status=result.ca.status}diagResult.sw=new Object;if(result.sw){diagResult.sw.cmVersion=result.sw.cmVersion;diagResult.sw.lastSWUpdate=result.sw.lastSWUpdate;diagResult.sw.version=result.sw.version;if(result.sw.modules){diagResult.sw.modules=new Object;diagResult.sw.modules.nas=result.sw.modules.nas;diagResult.sw.modules.nps=
result.sw.modules.nps;diagResult.sw.modules.sdk=result.sw.modules.sdk}}diagResult.transportstream=new Object;if(result.transportstream){diagResult.transportstream.lockSignal=result.transportstream.lockSignal!=null?result.transportstream.lockSignal:"";diagResult.transportstream.freq=result.transportstream.freq!=null?result.transportstream.freq:"";diagResult.transportstream.modulation=result.transportstream.modulation!=null?result.transportstream.modulation:"";diagResult.transportstream.bitRate=result.transportstream.bitRate!=
null?result.transportstream.bitRate:"";diagResult.transportstream.nid=result.transportstream.nid!=null?result.transportstream.nid:""}diagResult.freqscan=new Object;if(result.freqscan){diagResult.freqscan.tsid=result.freqscan.tsid!=null?result.freqscan.tsid:"";diagResult.freqscan.quality=result.freqscan.quality!=null?result.freqscan.quality:0;diagResult.freqscan.level=result.freqscan.level!=null?result.freqscan.level:0}diagResult.chanstatus=new Object;if(result.chanstatus){diagResult.chanstatus.lockStatus=
result.chanstatus.lockStatus!=null?result.chanstatus.lockStatus:"";diagResult.chanstatus.ber=result.chanstatus.ber!=null?result.chanstatus.ber:"";diagResult.chanstatus.freq=result.chanstatus.freq!=null?result.chanstatus.freq:"";diagResult.chanstatus.symbolRate=result.chanstatus.symbolRate!=null?result.chanstatus.symbolRate:"";diagResult.chanstatus.modulation=result.chanstatus.modulation!=null?result.chanstatus.modulation:"";diagResult.chanstatus.snr=result.chanstatus.snr!=null?result.chanstatus.snr:
"";diagResult.chanstatus.inversion=result.chanstatus.inversion!=null?result.chanstatus.inversion:"";diagResult.chanstatus.quality=result.chanstatus.quality!=null?result.chanstatus.quality:0;diagResult.chanstatus.level=result.chanstatus.level!=null?result.chanstatus.level:0}return diagResult}else return null}this.GetBootupState=function(callback){asyncMakeRequest("GetBootupState",mapEmptyObject,callback)};this.MapGetStartUpMode=function(callback){asyncMakeRequest("MapGetStartUpMode",mapEmptyObject,
callback)};this.MapSetStartUpMode=function(mode,callback){asyncMakeRequest("MapSetStartUpMode",{"mode":mode},callback)};this.RemotePairing=function(callback){asyncMakeRequest("MapRF4CBind",mapEmptyObject,callback)};this.RemoteUnbind=function(id,callback){var params=new Object;params.bindingId=id;asyncMakeRequest("MapRF4CUnbind",params,callback)};this.RemotePairingAbort=function(callback){asyncMakeRequest("MapRF4CAbortBind",mapEmptyObject,callback)};this.GetCacheUpdateStatus=function(callback){asyncMakeRequest("AppGetCacheUpdateStatus",
mapEmptyObject,callback)};this.SetCacheEventListener=function(callback,params){asyncMakeRequest("AppSetCacheEventListener",params,callback)};this.UpdateCache=function(callback){asyncMakeRequest("AppUpdateCache",mapEmptyObject,callback)};this.SwapCache=function(callback){asyncMakeRequest("AppSwapCache",mapEmptyObject,callback)};this.AbortCaching=function(callback){asyncMakeRequest("AppAbortCaching",mapEmptyObject,callback)};this.RemoveCacheEventListener=function(callback,params){asyncMakeRequest("AppRemoveCacheEventListener",
params,callback)};this.GetCADecoderStatus=function(callback){asyncMakeRequest("MapGetNagraSystemInfomation",mapEmptyObject,callback)};this.MapSwUpdateCheck=function(callback){asyncMakeRequest("MapSwCheckUpdate",mapEmptyObject,callback)};this.MapSwStartDownload=function(callback){asyncMakeRequest("MapSwStartDownload",mapEmptyObject,callback)};this.MapSwInstall=function(callback){asyncMakeRequest("MapSwInstall",mapEmptyObject,callback)};this.MapSwReboot=function(callback){asyncMakeRequest("MapSwReboot",
mapEmptyObject,callback)};this.MapSwDownloadProgress=function(callback){asyncMakeRequest("MapSwDownloadProgress",mapEmptyObject,callback)};this.MapSetAgeRating=function(newAgeRating,callback){newAgeRating=newAgeRating?newAgeRating:USER_AGE_RATING_OFF;param={};param.ageRating=newAgeRating;param.callbackParams=newAgeRating;asyncMakeRequest("MapSetUserAgeRating",param,callback)};this.MapSwReset=function(mode,callback){param={};param.mode=mode;asyncMakeRequest("MapSwReset",param,callback)}};
pmrpc=self.pmrpc=function(){if(typeof JSON==="undefined"||typeof JSON.stringify==="undefined"||typeof JSON.parse==="undefined")throw"pmrpc requires the JSON library";if(typeof this.postMessage==="undefined"&&typeof this.onconnect==="undefined")throw"pmrpc requires the HTML5 cross-document messaging and worker APIs";function generateUUID(){var uuid=[],nineteen="89AB",hex="0123456789ABCDEF";for(var i=0;i<36;i++)uuid[i]=hex[Math.floor(Math.random()*16)];uuid[14]="4";uuid[19]=nineteen[Math.floor(Math.random()*
4)];uuid[8]=uuid[13]=uuid[18]=uuid[23]="-";return uuid.join("")}function checkACL(accessControlList,origin){var aclWhitelist=accessControlList.whitelist;var aclBlacklist=accessControlList.blacklist;var isWhitelisted=false;var isBlacklisted=false;for(var i=0;i<aclWhitelist.length;++i)if(origin.match(new RegExp(aclWhitelist[i]))){isWhitelisted=true;break}for(var j=0;j<aclBlacklist.length;++j)if(origin.match(new RegExp(aclBlacklist[j]))){isBlacklisted=true;break}return isWhitelisted&&!isBlacklisted}
function invokeProcedure(fn,self,params,additionalParams){if(!(params instanceof Array)){var fnDef=fn.toString();var argNames=fnDef.substring(fnDef.indexOf("(")+1,fnDef.indexOf(")"));argNames=argNames===""?[]:argNames.split(", ");var argIndexes={};for(var i=0;i<argNames.length;i++)argIndexes[argNames[i]]=i;var callParameters=[];for(var paramName in params)if(typeof argIndexes[paramName]!=="undefined")callParameters[argIndexes[paramName]]=params[paramName];else throw"No such param: "+paramName;params=
callParameters}if(typeof additionalParams!=="undefined")params=params.concat(additionalParams);return fn.apply(self,params)}function encode(obj){return"pmrpc."+JSON.stringify(obj)}function decode(str){return JSON.parse(str.substring("pmrpc.".length))}function createJSONRpcBaseObject(){var call={};call.jsonrpc="2.0";return call}function createJSONRpcRequestObject(procedureName,parameters,id){var call=createJSONRpcBaseObject();call.method=procedureName;call.params=parameters;if(typeof id!=="undefined")call.id=
id;return call}function createJSONRpcErrorObject(errorcode,message,data){var error={};error.code=errorcode;error.message=message;error.data=data;return error}function createJSONRpcResponseObject(error,result,id){var response=createJSONRpcBaseObject();response.id=id;if(typeof error==="undefined"||error===null)response.result=result==="undefined"?null:result;else response.error=error;return response}var registeredServices={};var callQueue={};var reservedProcedureNames={};function register(config){if(config.publicProcedureName in
reservedProcedureNames)return false;else{registeredServices[config.publicProcedureName]={"publicProcedureName":config.publicProcedureName,"procedure":config.procedure,"context":config.procedure.context,"isAsync":typeof config.isAsynchronous!=="undefined"?config.isAsynchronous:false,"acl":typeof config.acl!=="undefined"?config.acl:{whitelist:["(.*)"],blacklist:[]}};return true}}function unregister(publicProcedureName){if(publicProcedureName in reservedProcedureNames)return false;else{delete registeredServices[publicProcedureName];
return true}}function fetchRegisteredService(publicProcedureName){return registeredServices[publicProcedureName]}function processPmrpcMessage(eventParams){var serviceCallEvent=eventParams.event;var eventSource=eventParams.source;var isWorkerComm=typeof eventSource!=="undefined"&&eventSource!==null;if(serviceCallEvent.data.indexOf("pmrpc.")!==0)return;else{var message=decode(serviceCallEvent.data);if(typeof message.method!=="undefined"){var newServiceCallEvent={data:serviceCallEvent.data,source:isWorkerComm?
eventSource:serviceCallEvent.source,origin:isWorkerComm?"*":serviceCallEvent.origin,shouldCheckACL:!isWorkerComm};var response=processJSONRpcRequest(message,newServiceCallEvent);if(response!==null)sendPmrpcMessage(newServiceCallEvent.source,response,newServiceCallEvent.origin)}else processJSONRpcResponse(message)}}function processJSONRpcRequest(request,serviceCallEvent,shouldCheckACL){if(request.jsonrpc!=="2.0")return createJSONRpcResponseObject(createJSONRpcErrorObject(-32600,"Invalid request.",
"The recived JSON is not a valid JSON-RPC 2.0 request."),null,null);var id=request.id;var service=fetchRegisteredService(request.method);if(typeof service!=="undefined")if(!serviceCallEvent.shouldCheckACL||checkACL(service.acl,serviceCallEvent.origin))try{if(service.isAsync){var cb=function(returnValue){sendPmrpcMessage(serviceCallEvent.source,createJSONRpcResponseObject(null,returnValue,id),serviceCallEvent.origin)};var eb=function(errorValue){sendPmrpcMessage(serviceCallEvent.source,createJSONRpcResponseObject(createJSONRpcErrorObject(-1,
"Application error.",errorValue.message),null,id),serviceCallEvent.origin)};invokeProcedure(service.procedure,service.context,request.params,[cb,eb,serviceCallEvent]);return null}else{var returnValue=invokeProcedure(service.procedure,service.context,request.params,[serviceCallEvent]);return typeof id==="undefined"?null:createJSONRpcResponseObject(null,returnValue,id)}}catch(error){if(typeof id==="undefined")return null;if(error.match("^(No such param)"))return createJSONRpcResponseObject(createJSONRpcErrorObject(-32602,
"Invalid params.",error.message),null,id);return createJSONRpcResponseObject(createJSONRpcErrorObject(-1,"Application error.",error.message),null,id)}else return typeof id==="undefined"?null:createJSONRpcResponseObject(createJSONRpcErrorObject(-2,"Application error.","Access denied on server."),null,id);else return typeof id==="undefined"?null:createJSONRpcResponseObject(createJSONRpcErrorObject(-32601,"Method not found.","The requestd remote procedure does not exist or is not available."),null,id)}
function processJSONRpcResponse(response){var id=response.id;var callObj=callQueue[id];if(typeof callObj==="undefined"||callObj===null)return;else delete callQueue[id];if(typeof response.error==="undefined")callObj.onSuccess({"destination":callObj.destination,"publicProcedureName":callObj.publicProcedureName,"params":callObj.params,"status":"success","returnValue":response.result});else callObj.onError({"destination":callObj.destination,"publicProcedureName":callObj.publicProcedureName,"params":callObj.params,
"status":"error","message":response.error.message+" "+response.error.data})}function call(config){if(config.retries&&config.retries<0)throw new Exception("number of retries must be 0 or higher");var destContexts=[];if(typeof config.destination==="undefined"||config.destination===null||config.destination==="workerParent")destContexts=[{context:null,type:"workerParent"}];else if(config.destination==="publish")destContexts=findAllReachableContexts();else if(config.destination instanceof Array)for(var i=
0;i<config.destination.length;i++)if(config.destination[i]==="workerParent")destContexts.push({context:null,type:"workerParent"});else if(typeof config.destination[i].frames!=="undefined")destContexts.push({context:config.destination[i],type:"window"});else destContexts.push({context:config.destination[i],type:"worker"});else if(typeof config.destination.frames!=="undefined")destContexts.push({context:config.destination,type:"window"});else destContexts.push({context:config.destination,type:"worker"});
for(var i=0;i<destContexts.length;i++){var callObj={destination:destContexts[i].context,destinationDomain:typeof config.destinationDomain==="undefined"?["*"]:typeof config.destinationDomain==="string"?[config.destinationDomain]:config.destinationDomain,publicProcedureName:config.publicProcedureName,onSuccess:typeof config.onSuccess!=="undefined"?config.onSuccess:function(){},onError:typeof config.onError!=="undefined"?config.onError:function(){},retries:typeof config.retries!=="undefined"?config.retries:
5,timeout:typeof config.timeout!=="undefined"?config.timeout:500,status:"requestNotSent"};isNotification=typeof config.onError==="undefined"&&typeof config.onSuccess==="undefined";params=typeof config.params!=="undefined"?config.params:[];callId=generateUUID();callQueue[callId]=callObj;if(isNotification)callObj.message=createJSONRpcRequestObject(config.publicProcedureName,params);else callObj.message=createJSONRpcRequestObject(config.publicProcedureName,params,callId);waitAndSendRequest(callId)}}
function sendPmrpcMessage(destination,message,acl){if(typeof destination==="undefined"||destination===null)self.postMessage(encode(message));else if(typeof destination.frames!=="undefined")return destination.postMessage(encode(message),acl);else destination.postMessage(encode(message))}function waitAndSendRequest(callId){try{var callObj=callQueue[callId];if(typeof callObj==="undefined")return;else if(callObj.retries<=-1){processJSONRpcResponse(createJSONRpcResponseObject(createJSONRpcErrorObject(-4,
"Application error.","Destination unavailable."),null,callId));NAF.utils.cleanupProps(callQueue[callId]);delete callQueue[callId]}else if(callObj.status==="requestSent"){NAF.utils.cleanupProps(callQueue[callId]);delete callQueue[callId];return}else if(callObj.retries===0||callObj.status==="available"){callObj.status="requestSent";callObj.retries=-1;callQueue[callId]=callObj;self.setTimeout(function(){waitAndSendRequest(callId)},callObj.timeout);for(var i=0;i<callObj.destinationDomain.length;i++)sendPmrpcMessage(callObj.destination,
callObj.message,callObj.destinationDomain[i],callObj)}else{callObj.status="pinging";callObj.retries=callObj.retries-1;call({"destination":callObj.destination,"publicProcedureName":"receivePingRequest","onSuccess":function(callResult){if(callResult.returnValue===true&&typeof callQueue[callId]!=="undefined"){callQueue[callId].status="available";waitAndSendRequest(callId)}},"params":[callObj.publicProcedureName],"retries":0,"destinationDomain":callObj.destinationDomain});callQueue[callId]=callObj;self.setTimeout(function(){if(callQueue[callId]&&
callQueue[callId].status==="pinging")waitAndSendRequest(callId)},callObj.timeout/callObj.retries)}}catch(error){}finally{callObj=null}}function addCrossBrowserEventListerner(obj,eventName,handler,bubble){if("addEventListener"in obj)obj.addEventListener(eventName,handler,bubble);else obj.attachEvent("on"+eventName,handler)}function createHandler(method,source,destinationType){return function(event){var params={event:event,source:source,destinationType:destinationType};method(params)}}if("window"in
this){var handler=createHandler(processPmrpcMessage,null,"window");addCrossBrowserEventListerner(this,"message",handler,false)}else if("onmessage"in this){var handler=createHandler(processPmrpcMessage,this,"worker");addCrossBrowserEventListerner(this,"message",handler,false)}else if("onconnect"in this){var connectHandler=function(e){var handler=createHandler(processPmrpcMessage,e.ports[0],"sharedWorker");addCrossBrowserEventListerner(e.ports[0],"message",handler,false);e.ports[0].start()};addCrossBrowserEventListerner(this,
"connect",connectHandler,false)}else throw"Pmrpc must be loaded within a browser window or web worker.";var createDedicatedWorker=this.Worker;this.nonPmrpcWorker=createDedicatedWorker;var createSharedWorker=this.SharedWorker;this.nonPmrpcSharedWorker=createSharedWorker;var allWorkers=[];this.Worker=function(scriptUri){var newWorker=new createDedicatedWorker(scriptUri);allWorkers.push({context:newWorker,type:"worker"});var handler=createHandler(processPmrpcMessage,newWorker,"worker");addCrossBrowserEventListerner(newWorker,
"message",handler,false);return newWorker};this.SharedWorker=function(scriptUri,workerName){var newWorker=new createSharedWorker(scriptUri,workerName);allWorkers.push({context:newWorker,type:"sharedWorker"});var handler=createHandler(processPmrpcMessage,newWorker.port,"sharedWorker");addCrossBrowserEventListerner(newWorker.port,"message",handler,false);newWorker.postMessage=function(msg,portArray){return newWorker.port.postMessage(msg,portArray)};newWorker.port.start();return newWorker};function receivePingRequest(publicProcedureName){return typeof fetchRegisteredService(publicProcedureName)!==
"undefined"}function subscribe(params){return register(params)}function unsubscribe(params){return unregister(params)}function findAllWindows(){var allWindowContexts=[];if(typeof window!=="undefined"){allWindowContexts.push({context:window.top,type:"window"});for(var i=0;typeof allWindowContexts[i]!=="undefined";i++){var currentWindow=allWindowContexts[i];for(var j=0;j<currentWindow.context.frames.length;j++)allWindowContexts.push({context:currentWindow.context.frames[j],type:"window"})}}else allWindowContexts.push({context:this,
type:"workerParent"});return allWindowContexts}function findAllWorkers(){return allWorkers}function findAllReachableContexts(){var allWindows=findAllWindows();var allWorkers=findAllWorkers();var allContexts=allWindows.concat(allWorkers);return allContexts}register({"publicProcedureName":"receivePingRequest","procedure":receivePingRequest});function getRegisteredProcedures(){var regSvcs=[];var origin=typeof this.frames!=="undefined"?window.location.protocol+"//"+window.location.host+(window.location.port!==
""?":"+window.location.port:""):"";for(var publicProcedureName in registeredServices)if(publicProcedureName in reservedProcedureNames)continue;else regSvcs.push({"publicProcedureName":registeredServices[publicProcedureName].publicProcedureName,"acl":registeredServices[publicProcedureName].acl,"origin":origin});return regSvcs}register({"publicProcedureName":"getRegisteredProcedures","procedure":getRegisteredProcedures});function discover(params){var windowsForDiscovery=null;if(typeof params.destination===
"undefined"){windowsForDiscovery=findAllReachableContexts();for(var i=0;i<windowsForDiscovery.length;i++)windowsForDiscovery[i]=windowsForDiscovery[i].context}else windowsForDiscovery=params.destination;var originRegex=typeof params.originRegex==="undefined"?"(.*)":params.originRegex;var nameRegex=typeof params.nameRegex==="undefined"?"(.*)":params.nameRegex;var counter=windowsForDiscovery.length;var discoveredMethods=[];function addToDiscoveredMethods(methods,destination){for(var i=0;i<methods.length;i++)if(methods[i].origin.match(new RegExp(originRegex))&&
methods[i].publicProcedureName.match(new RegExp(nameRegex)))discoveredMethods.push({publicProcedureName:methods[i].publicProcedureName,destination:destination,procedureACL:methods[i].acl,destinationOrigin:methods[i].origin})}pmrpc.call({destination:windowsForDiscovery,destinationDomain:"*",publicProcedureName:"getRegisteredProcedures",onSuccess:function(callResult){counter--;addToDiscoveredMethods(callResult.returnValue,callResult.destination);if(counter===0)params.callback(discoveredMethods)},onError:function(callResult){counter--;
if(counter===0)params.callback(discoveredMethods)}})}reservedProcedureNames={"getRegisteredProcedures":null,"receivePingRequest":null};return{register:register,unregister:unregister,call:call,discover:discover}}();if(typeof define=="function"&&define.amd)define(pmrpc);
WebApp.Controller=function(model){var self=this;model=model?model:new WebApp.Model;var emitter2=new WebApp.EventEmitter({wildcard:true}),getlocators=true,pretuneTimer=null,RTSP=2,SMHEADEND,SMHEADENDMAP,SMHEADENDLASTUSE,that=this,traxisVersion=2.23,traxis=null;var log=new NAF.utils.Log;var urlsExpectedInInitialization;urlsExpectedInInitialization=["model.channels","model.state.players","model.state.applications","model.state.system"];log.enable();if(NAF.conf.debug===0)log.setLevel.error();else if(NAF.conf.debug===
1)log.setLevel.warn();else if(NAF.conf.debug===2)log.setLevel.debug();else if(NAF.conf.debug===3)log.setLevel.trace();else if(NAF.conf.debug===4)log.setLevel.info();else log.disable();this.loadCallbacks={};this.onCallbacks={};this.onCallbacksReverseMap={};this.callbackCounter=0;this.backwardCompatibilityMode=false;if(NAF.conf.bkwdCompatibleNotifications)this.backwardCompatibilityMode=true;this.on=function(modelUrl,onNotifyCB){log.debug("WebApp: controller.on('"+modelUrl+"', "+(onNotifyCB.name?onNotifyCB.name:
"anonymous")+")");if(self.backwardCompatibilityMode||modelUrl==="model.initialized"||modelUrl==="model.state.key"||modelUrl==="model.state.settings.current.profile")emitter2.on(modelUrl,onNotifyCB);else{var callbackKey=generateCallbackKey("on-callback-");self.onCallbacks[callbackKey]=onNotifyCB;self.onCallbacksReverseMap[onNotifyCB]=callbackKey;var params=[modelUrl,callbackKey];PMRPCCall("on",params)}};this.off=function(modelUrl,onNotifyCB){log.debug("WebApp: controller.off('"+modelUrl+"', "+(onNotifyCB.name?
onNotifyCB.name:"anonymous")+")");if(self.backwardCompatibilityMode||modelUrl==="model.initialized"||modelUrl==="model.state.key"||modelUrl==="model.state.settings.current.profile")emitter2.off(modelUrl,onNotifyCB);else{var callbackKey=self.onCallbacksReverseMap[onNotifyCB];var params=[modelUrl,callbackKey];delete self.onCallbacks[callbackKey];delete self.onCallbacksReverseMap[onNotifyCB];PMRPCCall("off",params)}};this.init=function(){log.trace("WebApp: controller.init()");PMRPCCall("init",urlsExpectedInInitialization,
handleInitReply)};this["do"]=function(stateUrl,modelUrl){try{log.debug("WebApp: controller.do('"+stateUrl+"'"+(modelUrl?", '"+modelUrl+"'":"")+")");filterDoCommand(stateUrl,modelUrl);var params=[stateUrl,modelUrl];PMRPCCall("do",params)}catch(error){log.error("WebApp.Controller: error thrown BY WEBAPP processing do - "+error);if(error.stack)log.error(error.stack)}};function generateCallbackKey(prefix){return prefix+self.callbackCounter++}this.load=function(modelUrl,loadNotifyCB){try{log.debug("WebApp: controller.load('"+
modelUrl+"', "+(loadNotifyCB&&loadNotifyCB.name?loadNotifyCB.name:"anonymous")+")");var callbackKey=generateCallbackKey("load-callback-");self.loadCallbacks[callbackKey]=loadNotifyCB;var params=[modelUrl,callbackKey];PMRPCCall("load",params)}catch(error){log.error("WebApp.Controller: error thrown BY WEBAPP processing load - "+error);if(error.stack)log.error(error.stack)}};this.registerPMRPC=function(){pmrpc.register({publicProcedureName:"update-model",procedure:function(param){try{log.trace("WebApp.Controller: pmrpc model update message received - "+
param);if(model.initialized)self.UpdateModel(param);else log.trace("WebApp.Controller: ignoring model update "+"prior to completing initialization")}catch(error){log.error("WebApp.Controller: error thrown BY WEBAPP processing model update - "+error);if(error.stack)log.error(error.stack)}}});pmrpc.register({publicProcedureName:"load-callback",procedure:function(param){try{log.trace("WebApp.Controller: pmrpc load callback received - "+param);self.processLoadCallback(param)}catch(error){log.error("WebApp.Controller: error processing load callback - "+
error);if(error.stack)log.error(error.stack)}}});pmrpc.register({publicProcedureName:"on-callback",procedure:function(param){try{log.trace("WebApp.Controller: pmrpc 'on' callback received - "+param);self.processOnCallback(param)}catch(error){log.error("WebApp.Controller: error processing 'on' callback - "+error);if(error.stack)log.error(error.stack)}}});pmrpc.register({publicProcedureName:"off-callback",procedure:function(param){try{log.trace("WebApp.Controller: pmrpc 'off' callback received - "+
param);self.processOffCallback(param)}catch(error){log.error("WebApp.Controller: error processing 'off' callback - "+error);if(error.stack)log.error(error.stack)}}})};this.UpdateModel=function(param){try{if(param[0]==="key"){log.trace("WebApp.Controller: key input received - "+JSON.stringify(param[1]));model.state.key=param[1];notifyView("model.state.key")}else if(param[0]=="application"){var thisAppHadFocusPreviously=model.state.applications[param[1]].inFocus;model.state.applications[param[1]].inFocus=
param[2]=="true";if(model.state.applications[param[1]].inFocus)if(!thisAppHadFocusPreviously)log.trace("WebApp.Controller: app "+param[1]+" already had focus");else{removeFocusFromOtherApplications(param[1]);log.trace("WebApp.Controller: focus set on app "+param[1]);if(self.backwardCompatibilityMode)notifyView("model.state.applications."+param[1])}else log.trace("WebApp.Controller: focus unset on app "+param[1])}else if(param[0]=="channels"){log.trace("WebApp.Controller: channel array update received");
model.channels=param[1]}else if(param[0]=="applications"){log.trace("WebApp.Controller: application array update received");var previousApplicationArray=model.state.applications;model.state.applications=param[1];if(self.backwardCompatibilityMode)detectApplicationChangeEventsAndNotify(previousApplicationArray)}else if(param[0]=="players"){log.trace("WebApp.Controller: player array update received");var previousPlayerArray=model.state.players;model.state.players=param[1];if(self.backwardCompatibilityMode)detectPlayerChangeEventsAndNotify(previousPlayerArray)}else if(param[0]==
"channelTuned"){log.trace("WebApp.Controller: channel tuned update received - "+"player "+param[1]+", channel "+param[2]);var playerIdx=param[1];if(param[2]!=undefined){model.state.players[playerIdx].source.idx=param[2];if(self.backwardCompatibilityMode)notifyView("model.state.players."+playerIdx+".source","model.state.players."+playerIdx+".source")}}else if(param[0]=="currentProfile"){log.trace("WebApp.Controller: current profile settings update received");model.state.settings.current.profile=param[1];
notifyView("model.state.settings.current.profile")}}catch(error){log.error("initWidgetModel error - "+error);if(error.stack)log.error(error.stack)}};this.processLoadCallback=function(param){try{var callbackKey=param[0];var url=param[1];if(self.loadCallbacks[callbackKey]===undefined){log.error("WebApp.Controller: could not identify callback "+"with key "+callbackKey);return}self.loadCallbacks[callbackKey].apply(self,[url]);delete self.loadCallbacks[callbackKey]}catch(error){log.error("initWidgetModel error - "+
error);if(error.stack)log.error(error.stack)}};this.processOnCallback=function(param){try{var callbackKey=param[0];var url=param[1];var data=param[2];self.storeTransmittedModelData(url,data);if(self.onCallbacks[callbackKey]===undefined){log.error("WebApp.Controller: could not identify 'on' "+"callback with key "+callbackKey);return}log.trace("WebApp.Controller: calling proxied listener for "+url);self.onCallbacks[callbackKey].apply(self,[url])}catch(error){log.error("initWidgetModel error - "+error);
if(error.stack)log.error(error.stack)}};this.storeTransmittedModelData=function(url,data){try{var javascriptModelVariable=url.replace(/(\.)([0-9]+)/g,"[$2]");var javascriptStatement=javascriptModelVariable+" = data;";eval(javascriptStatement)}catch(ex){log.warn("WebApp.Controller: Cannot evaluate transmitted model data. "+ex)}};this.processOffCallback=function(param){try{var callbackKey=param[0];var url=param[1];if(self.offCallbacks[callbackKey]===undefined){log.error("WebApp.Controller: could not identify 'off' "+
"callback with key "+callbackKey);return}self.offCallbacks[callbackKey].apply(self,[url]);delete self.offCallbacks[callbackKey]}catch(error){log.error("initWidgetModel error - "+error);if(error.stack)log.error(error.stack)}};var applicationIndex=null;this.getApplicationIndex=function(defaultValue){if(applicationIndex!=null)return applicationIndex;for(var i=0;i<model.state.applications.length;i++)if(window.name===model.state.applications[i].windowId){applicationIndex=i;return i}if(defaultValue!=undefined)return defaultValue;
log.error("WebApp.Controller: app index queried, "+"but no app with window name "+window.name+" currently stored in model");throw new Error("no app with window name "+window.name+" currently stored in model");};function removeFocusFromOtherApplications(idxChanged){var app=model.state.applications;var idx=parseInt(idxChanged);for(var appIdx=0;appIdx<app.length;appIdx++){if(appIdx===idx)continue;var hadFocus=model.state.applications[appIdx].inFocus;model.state.applications[appIdx].inFocus=false}}function filterDoCommand(stateUrl,
modelUrl){if(stateUrl.match(/^model\.state\.applications\.\d+\.appMsg$/)&&modelUrl instanceof Object)if(modelUrl.sourceId==undefined){var app_i;try{app_i=self.getApplicationIndex();modelUrl.sourceId=model.state.applications[app_i].id;log.trace("WebApp.Controller: supplying appMsg sourceId - "+modelUrl.sourceId+" for app #"+app_i)}catch(error){app_i=-1;modelUrl.sourceId="unknown"}}else log.trace("WebApp.Controller: using webapp-supplied"+" appMsg sourceId - "+modelUrl.sourceId);if(modelUrl instanceof
Object){modelUrl.serializedObjectType=modelUrl.constructor.name;log.trace("WebApp.Controller: serializing object type of do() "+"argument and embedding type name - "+modelUrl.constructor.name)}}function handleInitReply(initReply){log.trace("WebApp.Controller: received init reply");model.channels=initReply.returnValue[0];model.state.players=initReply.returnValue[1];model.state.applications=initReply.returnValue[2];model.state.system=initReply.returnValue[3];model.initialized=true;log.trace("WebApp.Controller: WebApp.model is initialized");
notifyView("model.initialized")}function notifyView(modelURL){try{log.debug("WebApp.Controller: notifyView('"+modelURL+"')");setTimeout(function(){emitter2.emit(modelURL,modelURL)},0)}catch(error){log.error("WebApp.Controller: error thrown by listener for event "+modelURL+" - "+error);if(error.stack)log.error(error.stack)}}function PMRPCCall(procedure,params,successReplyHandler){if(successReplyHandler==undefined)successReplyHandler=pmrpcSuccessCallback;params.splice(0,0,window.name);log.trace("WebApp.Controller: sending pmrpc call to master controller - "+
procedure+"("+JSON.stringify(params)+")");pmrpc.call({destination:window.top,publicProcedureName:procedure,params:[params],timeout:1E4,onSuccess:successReplyHandler,onError:pmrpcErrorCallback})}function pmrpcSuccessCallback(returnObject){try{log.trace("WebApp.Controller: pmrpc message ("+returnObject.publicProcedureName+") delivery confirmed");if(returnObject.returnValue!=undefined){log.trace("WebApp.Controller: object returned from pmrpc message send:  "+JSON.stringify(returnObject.returnValue));
log.warn("WebApp.Controller: this return object is ignored")}}catch(error){log.error("initWidgetModel error - "+error);if(error.stack)log.error(error.stack)}}function pmrpcErrorCallback(statusObject){try{log.error("WebApp.Controller: pmrpc message "+statusObject.publicProcedureName+"("+JSON.stringify(statusObject.params)+") send FAILED");log.error("WebApp.Controller: error status info returned: "+statusObject.message)}catch(error){log.error("initWidgetModel error - "+error);if(error.stack)log.error(error.stack)}}
function detectApplicationChangeEventsAndNotify(previousApplicationArray){if(previousApplicationArray.length==0)return;for(var app_i=0;app_i<previousApplicationArray.length;app_i++){if(objectChanged(previousApplicationArray[app_i].state,model.state.applications[app_i].state)){log.trace("WebApp.Controller: "+describeApplicationPropertyChange(previousApplicationArray,app_i,"state")+", notifying view");notifyView("model.state.applications."+app_i+".state")}if(objectChanged(previousApplicationArray[app_i].appMsg,
model.state.applications[app_i].appMsg)){log.trace("WebApp.Controller: "+describeApplicationPropertyChange(previousApplicationArray,app_i,"appMsg")+", notifying view");notifyView("model.state.applications."+app_i+".appMsg")}if(previousApplicationArray[app_i].media==undefined&&model.state.applications[app_i].media!=undefined){if(model.state.applications[app_i].media.assets&&model.state.applications[app_i].media.assets.length>0){log.trace("WebApp.Controller: app media data was created");for(var asset_i=
0;asset_i<model.state.applications[app_i].media.assets.length;asset_i++)notifyView("model.state.applications."+app_i+".media.assets."+asset_i)}}else if(previousApplicationArray[app_i].media!=undefined&&model.state.applications[app_i].media==undefined)log.warn("WebApp.Controller: "+"app media data was either deleted");else if(objectChanged(previousApplicationArray[app_i].media.assets,model.state.applications[app_i].media.assets))if(model.state.applications[app_i].media.assets.length>previousApplicationArray[app_i].media.assets.length){log.trace("WebApp.Controller: "+
"media asset list grew (from "+previousApplicationArray[app_i].media.assets.length+" to "+model.state.applications[app_i].media.assets.length+"), notifying view");notifyView("model.state.applications."+app_i+".media.assets."+(model.state.applications[app_i].media.assets.length-1))}}}function describeApplicationPropertyChange(previousApplicationArray,app_i,propertyKey){var beforeValue=previousApplicationArray[app_i][propertyKey];var afterValue=model.state.applications[app_i][propertyKey];var beforeDescription;
var afterDescription;if(beforeValue instanceof Object)beforeDescription=JSON.stringify(beforeValue).substring(0,100);else beforeDescription=beforeValue;if(afterValue instanceof Object)afterDescription=JSON.stringify(afterValue).substring(0,100);else afterDescription=afterValue;return"model.state.applications."+app_i+"."+propertyKey+" changed from "+beforeDescription+" to "+afterDescription}function detectPlayerChangeEventsAndNotify(previousPlayerArray){if(previousPlayerArray.length==0)return;for(var player_i=
0;player_i<previousPlayerArray.length;player_i++){if(objectChanged(previousPlayerArray[player_i].currentProgram,model.state.players[player_i].currentProgram)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"currentProgram")+", notifying view");notifyView("model.state.players."+player_i+".currentProgram")}if(objectChanged(previousPlayerArray[player_i].isBlocked,model.state.players[player_i].isBlocked)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,
player_i,"isBlocked")+", notifying view");notifyView("model.state.players."+player_i+".isBlocked")}if(objectChanged(previousPlayerArray[player_i].playRate,model.state.players[player_i].playRate)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"playRate")+", notifying view");notifyView("model.state.players."+player_i+".playRate")}if(objectChanged(previousPlayerArray[player_i].source,model.state.players[player_i].source)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,
player_i,"source")+", notifying view");notifyView("model.state.players."+player_i+".source")}if(objectChanged(previousPlayerArray[player_i].status,model.state.players[player_i].status)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"status")+", notifying view");notifyView("model.state.players."+player_i+".status")}if(objectChanged(previousPlayerArray[player_i].position,model.state.players[player_i].position)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,
player_i,"position")+", notifying view");notifyView("model.state.players."+player_i+".position")}if(objectChanged(previousPlayerArray[player_i].availAudioLangs,model.state.players[player_i].availAudioLangs)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"availAudioLangs")+", notifying view");notifyView("model.state.players."+player_i+".availAudioLangs")}if(objectChanged(previousPlayerArray[player_i].audioLang,model.state.players[player_i].audioLang)){log.trace("WebApp.Controller: "+
describePlayerPropertyChange(previousPlayerArray,player_i,"audioLang")+", notifying view");notifyView("model.state.players."+player_i+".audioLang")}if(objectChanged(previousPlayerArray[player_i].availSubtitleLangs,model.state.players[player_i].availSubtitleLangs)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"availSubtitleLangs")+", notifying view");notifyView("model.state.players."+player_i+".availSubtitleLangs")}if(objectChanged(previousPlayerArray[player_i].subtitleLang,
model.state.players[player_i].subtitleLang)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"subtitleLang")+", notifying view");notifyView("model.state.players."+player_i+".subtitleLang")}else if(objectChanged(previousPlayerArray[player_i].subtitleLang.enable,model.state.players[player_i].subtitleLang.enable)){log.trace("WebApp.Controller: model.state.players."+player_i+".subtitleLang.enable changed from "+previousPlayerArray[player_i].subtitleLang.enable+
" to "+model.state.players[player_i].subtitleLang.enable+", notifying view");notifyView("model.state.players."+player_i+".subtitleLang.enable")}if(objectChanged(previousPlayerArray[player_i].teletextLang,model.state.players[player_i].teletextLang)){log.trace("WebApp.Controller: "+describePlayerPropertyChange(previousPlayerArray,player_i,"teletextLang")+", notifying view");notifyView("model.state.players."+player_i+".teletextLang")}if(objectChanged(previousPlayerArray[player_i].window,model.state.players[player_i].window)){log.trace("WebApp.Controller: "+
describePlayerPropertyChange(previousPlayerArray,player_i,"window")+", notifying view");notifyView("model.state.players."+player_i+".window")}}}function describePlayerPropertyChange(previousPlayerArray,player_i,propertyKey){var beforeValue=previousPlayerArray[player_i][propertyKey];var afterValue=model.state.players[player_i][propertyKey];var beforeDescription;var afterDescription;if(beforeValue instanceof Object)beforeDescription=JSON.stringify(beforeValue).substring(0,100);else beforeDescription=
beforeValue;if(afterValue instanceof Object)afterDescription=JSON.stringify(afterValue).substring(0,100);else afterDescription=afterValue;return"model.state.players."+player_i+"."+propertyKey+" changed from "+beforeDescription+" to "+afterDescription}function objectChanged(x,y){return!objectEquals(x,y)&&!bothObjectsNotNullOrUndefined(x,y)}function objectEquals(x,y){if(x instanceof Function){if(y instanceof Function)return x.toString()===y.toString();return false}if(x===null||x===undefined||y===null||
y===undefined)return x===y;if(x===y||x.valueOf()===y.valueOf())return true;if(x instanceof Date)return false;if(y instanceof Date)return false;if(!(x instanceof Object))return false;if(!(y instanceof Object))return false;var p=Object.keys(x);return Object.keys(y).every(function(i){return p.indexOf(i)!==-1})?p.every(function(i){return objectEquals(x[i],y[i])}):false}function bothObjectsNotNullOrUndefined(objA,objB){return(objA===null||objA===undefined)&&(objB===null||objB===undefined)}};
!function(exports,undefined){var isArray=Array.isArray?Array.isArray:function _isArray(obj){return Object.prototype.toString.call(obj)==="[object Array]"};var defaultMaxListeners=10;function init(){this._events=new Object}function configure(conf){if(conf){conf.delimiter&&(this.delimiter=conf.delimiter);conf.wildcard&&(this.wildcard=conf.wildcard);if(this.wildcard)this.listenerTree=new Object}}WebApp.EventEmitter=function(conf){this._events=new Object;configure.call(this,conf)};function searchListenerTree(handlers,
type,tree,i){if(!tree)return[];var listeners=[],leaf,len,branch,xTree,xxTree,isolatedBranch,endReached,typeLength=type.length,currentType=type[i],nextType=type[i+1];if(i===typeLength&&tree._listeners)if(typeof tree._listeners==="function"){handlers&&handlers.push(tree._listeners);return[tree]}else{for(leaf=0,len=tree._listeners.length;leaf<len;leaf++)handlers&&handlers.push(tree._listeners[leaf]);return[tree]}if(currentType==="*"||currentType==="**"||tree[currentType]){if(currentType==="*"){for(var branch in tree)if(branch!==
"_listeners"&&tree.hasOwnProperty(branch))listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+1));return listeners}else if(currentType==="**"){endReached=i+1===typeLength||i+2===typeLength&&nextType==="*";if(endReached&&tree._listeners)listeners=listeners.concat(searchListenerTree(handlers,type,tree,typeLength));for(var branch in tree)if(branch!=="_listeners"&&tree.hasOwnProperty(branch))if(branch==="*"||branch==="**"){if(tree[branch]._listeners&&!endReached)listeners=listeners.concat(searchListenerTree(handlers,
type,tree[branch],typeLength));listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i))}else if(branch===nextType)listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i+2));else listeners=listeners.concat(searchListenerTree(handlers,type,tree[branch],i));return listeners}listeners=listeners.concat(searchListenerTree(handlers,type,tree[currentType],i+1))}xTree=tree["*"];if(xTree)searchListenerTree(handlers,type,xTree,i+1);xxTree=tree["**"];if(xxTree)if(i<typeLength){if(xxTree._listeners)searchListenerTree(handlers,
type,xxTree,typeLength);for(var branch in xxTree)if(branch!=="_listeners"&&xxTree.hasOwnProperty(branch))if(branch===nextType)searchListenerTree(handlers,type,xxTree[branch],i+2);else if(branch===currentType)searchListenerTree(handlers,type,xxTree[branch],i+1);else{isolatedBranch={};isolatedBranch[branch]=xxTree[branch];searchListenerTree(handlers,type,{"**":isolatedBranch},i+1)}}else if(xxTree._listeners)searchListenerTree(handlers,type,xxTree,typeLength);else if(xxTree["*"]&&xxTree["*"]._listeners)searchListenerTree(handlers,
type,xxTree["*"],typeLength);return listeners}function growListenerTree(type,listener){type=typeof type==="string"?type.split(this.delimiter):type.slice();for(var i=0,len=type.length;i+1<len;i++)if(type[i]==="**"&&type[i+1]==="**")return;var tree=this.listenerTree;var name=type.shift();while(name){if(!tree[name])tree[name]=new Object;tree=tree[name];if(type.length===0){if(!tree._listeners)tree._listeners=listener;else if(typeof tree._listeners==="function")tree._listeners=[tree._listeners,listener];
else if(isArray(tree._listeners)){tree._listeners.push(listener);if(!tree._listeners.warned){var m=defaultMaxListeners;if(typeof this._events.maxListeners!=="undefined")m=this._events.maxListeners;if(m>0&&tree._listeners.length>m){tree._listeners.warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",tree._listeners.length);console.trace()}}}return true}name=type.shift()}return true}WebApp.EventEmitter.prototype.delimiter=
".";WebApp.EventEmitter.prototype.setMaxListeners=function(n){this._events||init.call(this);this._events.maxListeners=n};WebApp.EventEmitter.prototype.event="";WebApp.EventEmitter.prototype.once=function(event,fn){this.many(event,1,fn);return this};WebApp.EventEmitter.prototype.many=function(event,ttl,fn){var self=this;if(typeof fn!=="function")throw new Error("many only accepts instances of Function");function listener(){if(--ttl===0)self.off(event,listener);fn.apply(this,arguments)}listener._origin=
fn;this.on(event,listener);return self};WebApp.EventEmitter.prototype.emit=function(){this._events||init.call(this);var type=arguments[0];if(type==="newListener")if(!this._events.newListener)return false;if(this._all){var l=arguments.length;var args=new Array(l-1);for(var i=1;i<l;i++)args[i-1]=arguments[i];for(var i=0,l=this._all.length;i<l;i++){this.event=type;this._all[i].apply(this,args)}}if(type==="error")if(!this._all&&!this._events.error&&!(this.wildcard&&this.listenerTree.error)){if(arguments[1]instanceof
Error)throw arguments[1];else throw new Error("Uncaught, unspecified 'error' event.");return false}var handler;if(this.wildcard){handler=[];var ns=typeof type==="string"?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handler,ns,this.listenerTree,0)}else handler=this._events[type];if(typeof handler==="function"){this.event=type;if(arguments.length===1)handler.call(this);else if(arguments.length>1)switch(arguments.length){case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,
arguments[1],arguments[2]);break;default:var l=arguments.length;var args=new Array(l-1);for(var i=1;i<l;i++)args[i-1]=arguments[i];handler.apply(this,args)}return true}else if(handler){var l=arguments.length;var args=new Array(l-1);for(var i=1;i<l;i++)args[i-1]=arguments[i];var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){this.event=type;listeners[i].apply(this,args)}return listeners.length>0||this._all}else return this._all};WebApp.EventEmitter.prototype.on=function(type,listener){if(typeof type===
"function"){this.onAny(type);return this}if(typeof listener!=="function")throw new Error("on only accepts instances of Function");this._events||init.call(this);this.emit("newListener",type,listener);if(this.wildcard){growListenerTree.call(this,type,listener);return this}if(!this._events[type])this._events[type]=listener;else if(typeof this._events[type]==="function")this._events[type]=[this._events[type],listener];else if(isArray(this._events[type])){this._events[type].push(listener);if(!this._events[type].warned){var m=
defaultMaxListeners;if(typeof this._events.maxListeners!=="undefined")m=this._events.maxListeners;if(m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}}return this};WebApp.EventEmitter.prototype.onAny=function(fn){if(!this._all)this._all=[];if(typeof fn!=="function")throw new Error("onAny only accepts instances of Function");
this._all.push(fn);return this};WebApp.EventEmitter.prototype.addListener=WebApp.EventEmitter.prototype.on;WebApp.EventEmitter.prototype.off=function(type,listener){if(typeof listener!=="function")throw new Error("removeListener only takes instances of Function");var handlers,leafs=[];if(this.wildcard){var ns=typeof type==="string"?type.split(this.delimiter):type.slice();leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0)}else{if(!this._events[type])return this;handlers=this._events[type];
leafs.push({_listeners:handlers})}for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];handlers=leaf._listeners;if(isArray(handlers)){var position=-1;for(var i=0,length=handlers.length;i<length;i++)if(handlers[i]===listener||handlers[i].listener&&handlers[i].listener===listener||handlers[i]._origin&&handlers[i]._origin===listener){position=i;break}if(position<0)return this;if(this.wildcard)leaf._listeners.splice(position,1);else this._events[type].splice(position,1);if(handlers.length===
0)if(this.wildcard)delete leaf._listeners;else delete this._events[type]}else if(handlers===listener||handlers.listener&&handlers.listener===listener||handlers._origin&&handlers._origin===listener)if(this.wildcard)delete leaf._listeners;else delete this._events[type]}return this};WebApp.EventEmitter.prototype.offAny=function(fn){var i=0,l=0,fns;if(fn&&this._all&&this._all.length>0){fns=this._all;for(i=0,l=fns.length;i<l;i++)if(fn===fns[i]){fns.splice(i,1);return this}}else this._all=[];return this};
WebApp.EventEmitter.prototype.removeListener=WebApp.EventEmitter.prototype.off;WebApp.EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){!this._events||init.call(this);return this}if(this.wildcard){var ns=typeof type==="string"?type.split(this.delimiter):type.slice();var leafs=searchListenerTree.call(this,null,ns,this.listenerTree,0);for(var iLeaf=0;iLeaf<leafs.length;iLeaf++){var leaf=leafs[iLeaf];leaf._listeners=null}}else{if(!this._events[type])return this;this._events[type]=
null}return this};WebApp.EventEmitter.prototype.listeners=function(type){if(this.wildcard){var handlers=[];var ns=typeof type==="string"?type.split(this.delimiter):type.slice();searchListenerTree.call(this,handlers,ns,this.listenerTree,0);return handlers}this._events||init.call(this);if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type]))this._events[type]=[this._events[type]];return this._events[type]};WebApp.EventEmitter.prototype.listenersAny=function(){if(this._all)return this._all;
else return[]};if(typeof define==="function"&&define.amd)define(function(){return WebApp.EventEmitter});else exports.EventEmitter2=WebApp.EventEmitter}(typeof process!=="undefined"&&typeof process.title!=="undefined"&&typeof exports!=="undefined"?exports:typeof window!=="undefined"?window:null);
WebApp.Model=function(){function ComponentLang(code,type){this.code=code;this.type=type}ComponentLang.create=function(){return new ComponentLang};function Player(src,rate,pos,windowstr,zidx,dur,code,type){this.source=src;this.currentChannel=src;this.playRate=rate;this.position=pos;this.window=windowstr;this.zIndex=zidx;this.duration=dur;this.status=null;this.availAudioLangs=[];this.availSubtitleLangs=[];this.audioLang=new ComponentLang(code,type);this.subtitleLang=new ComponentLang(code,type);this.teletextLang=
new ComponentLang(code,type);this.mapLoc=null;this.restricted=null;this.isBlocked=false;this.currentProgram=null;this.nextProgram=null}Player.create=function(){return new Player};function View(lang,langType,transparency,bannerTimeout,epgStyle,epgSpan,assetsStyle,settingsProtection){this.lang=new ComponentLang(lang,langType);this.transparency=transparency;this.bannerTimeout=bannerTimeout;this.epgStyle=epgStyle;this.epgSpan=epgSpan;this.assetsStyle=assetsStyle;this.settingsProtection=settingsProtection}
View.create=function(){return new View};function Favorites(){this.name="";this.items=[];this.type=""}Favorites.create=function(){return new Favorites};function Profile(lang1,lang2,ageRating){this.id="";this.favs=[new Favorites,new Favorites,new Favorites];this.prefAudioLangs=[new ComponentLang(lang1,null),new ComponentLang(lang2,null)];this.prefSubtitleLangs=[new ComponentLang(lang1,null),new ComponentLang(lang2,null)];this.prefTeletextLangs=[new ComponentLang(lang1,null),new ComponentLang(lang2,
null)];this.name="";this.status=0;this.startChannel=null;this.pins=new Array(3);this.ageRating=ageRating;this.view=new View;this.optIn=false;this.reminders=[];this.isSuspended=false}Profile.create=function(){return new Profile};function Settings(){this.current={}}Settings.create=function(){return new Settings};function State(){this.applications=[];this.key=null;this.players=[];this.settings=new Settings}State.create=function(){return new State};function AppMessage(id,sourceId,method){this.id=id;this.sourceId=
sourceId;this.method=method;this.message={}}AppMessage.create=function(){return new AppMessage};function Channel(idx,id,loc,lcn,name,pics,viewable,tevents){this.idx=idx;this.id=id;this.locator=loc;this.lcn=lcn;this.name=name;this.pictures=pics;this.viewable=viewable;this.isFav=false;this.plcn=0}Channel.create=function(){return new Channel};function System(){this.cpeid=""}System.create=function(){return new System};function Application(id,name,shortSynopsis,isAdult,isViewable,isEntitled,url,inFocus,
windowId,viewState,state,type){this.id=id;this.name=name;this.shortSynopsis=shortSynopsis;this.isAdult=isAdult;this.isViewable=isViewable;this.isEntitled=isEntitled;this.products=[];this.pictures=[];this.url=url;this.inFocus=inFocus;this.windowId=windowId;this.viewState=viewState;this.state=state;this.type=type;this.appMsg=new AppMessage;this.reservedKeys=[];this.appKeys=[];this.modelSets=[];this.media={assets:[]}}Application.create=function(){return new Application};function KeyMap(){this.VK_CANCEL=
3;this.VK_BACK_SPACE=8;this.VK_ENTER=13;this.VK_SHIFT=16;this.VK_PAUSE=19;this.VK_ACCEPT=30;this.VK_SPACE=32;this.VK_PAGE_UP=33;this.VK_PAGE_DOWN=34;this.VK_HOME=36;this.VK_LEFT=37;this.VK_UP=38;this.VK_RIGHT=39;this.VK_DOWN=40;this.VK_PERIOD=46;this.VK_0=48;this.VK_1=49;this.VK_2=50;this.VK_3=51;this.VK_4=52;this.VK_5=53;this.VK_6=54;this.VK_7=55;this.VK_8=56;this.VK_9=57;this.VK_A=65;this.VK_B=66;this.VK_C=67;this.VK_D=68;this.VK_E=69;this.VK_F=70;this.VK_G=71;this.VK_H=72;this.VK_I=73;this.VK_J=
74;this.VK_K=75;this.VK_L=76;this.VK_M=77;this.VK_N=78;this.VK_O=79;this.VK_P=80;this.VK_Q=81;this.VK_R=82;this.VK_S=83;this.VK_T=84;this.VK_U=85;this.VK_V=86;this.VK_W=87;this.VK_X=88;this.VK_Y=89;this.VK_Z=90;this.VK_HYPHEN=109;this.VK_EQUALS=61;this.VK_SQUARE_OPEN_BRACKET=503;this.VK_SQUARE_CLOSE_BRACKET=504;this.VK_CURLY_OPEN_BRACKET=505;this.VK_CURLY_CLOSE_BRACKET=506;this.VK_BACK_SLASH=92;this.VK_SEMICOLON=59;this.VK_SINGLE_QUOTE=222;this.VK_BACK_QUOTE=192;this.VK_COMMA=44;this.VK_PERIOD=46;
this.VK_FORWARD_SLASH=47;this.VK_A_WITH_GRAVE=507;this.VK_E_WITH_GRAVE=508;this.VK_EXCLAMATION=509;this.VK_AT_SIGN=510;this.VK_HASH=511;this.VK_DOLLAR=512;this.VK_PERCENT=513;this.VK_CARET=514;this.VK_AMPERSAND=515;this.VK_ASTERISK=106;this.VK_OPEN_BRACKET=91;this.VK_CLOSE_BRACKET=93;this.VK_UNDERSCORE=516;this.VK_PLUS=107;this.VK_COLON=517;this.VK_DOUBLE_QUOTE=518;this.VK_TILDE=519;this.VK_OPEN_ANGULAR_BRACKET=520;this.VK_CLOSE_ANGULAR_BRACKET=521;this.VK_QUESTION_MARK=522;this.VK_E_WITH_CIRCUMFLEX=
523;this.VK_O_WITH_CIRCUMFLEX=524;this.VK_U_WITH_CIRCUMFLEX=525;this.VK_E_WITH_ACUTE=526;this.VK_A_WITH_DIAERESIS=527;this.VK_O_WITH_DIAERESIS=528;this.VK_BETA_SIGN=529;this.VK_U_WITH_DIAERESIS=530;this.VK_EURO_SIGN=531;this.VK_ACUTE_SIGN=532;this.VK_C_WITH_CEDILLA=533;this.VK_SECTION_SIGN=534;this.VK_POUND_SIGN=535;this.VK_DOUBLE_ACUTE_SIGN=536;this.VK_DIAERESIS_SIGN=537;this.VK_E_WITH_OGONEK=538;this.VK_O_WITH_ACUTE=539;this.VK_A_WITH_OGONEK=540;this.VK_S_WITH_ACUTE=541;this.VK_DOES_NOT_DIVIDE_SIGN=
542;this.VK_Z_WITH_DOT_ABOVE=543;this.VK_Z_WITH_ACUTE=544;this.VK_C_WITH_ACUTE=545;this.VK_N_WITH_ACUTE=546;this.VK_E_WITH_DIAERESIS=547;this.VK_I_WITH_DIAERESIS=548;this.VK_A_WITH_CIRCUMFLEX=549;this.VK_U_WITH_GRAVE=550;this.VK_I_WITH_CIRCUMFLEX=551;this.VK_U_WITH_ACUTE=552;this.VK_I_WITH_ACUTE=553;this.VK_A_WITH_ACUTE=554;this.VK_N_WITH_TILDE=555;this.VK_E_WITH_CARON=556;this.VK_R_WITH_CARON=557;this.VK_T_WITH_ACUTE=558;this.VK_Z_WITH_CARON=559;this.VK_U_WITH_RING=560;this.VK_S_WITH_BREVE=561;this.VK_D_WITH_ACUTE=
562;this.VK_L_WITH_ACUTE=563;this.VK_Y_WITH_ACUTE=564;this.VK_C_WITH_BREVE=565;this.VK_N_WITH_CARON=566;this.VK_DELETE=127;this.VK_HELP=156;this.VK_RED=403;this.VK_GREEN=404;this.VK_YELLOW=405;this.VK_BLUE=406;this.VK_POWER=409;this.VK_REWIND=412;this.VK_STOP=413;this.VK_PLAY=415;this.VK_RECORD=416;this.VK_FAST_FWD=417;this.VK_REW_SKIP=424;this.VK_FWD_SKIP=425;this.VK_CHANNEL_UP=427;this.VK_CHANNEL_DOWN=428;this.VK_FAV=433;this.VK_VOLUME_UP=447;this.VK_VOLUME_DOWN=448;this.VK_MUTE=449;this.VK_INFO=
457;this.VK_GUIDE=458;this.VK_TELETEXT=459;this.VK_ON_DEMAND=501;this.VK_MYDVR=502;this.VK_SUBTITLE=460;this.VK_BACK=461;this.VK_MENU=462;this.VK_TV=475}KeyMap.create=function(){return new KeyMap};function MediaAsset(id,name,URL,picture,type,mimeType,encoding,description,genre,date,size,duration,ageRating){this.id=id;this.name=name;this.URL=URL;this.picture=picture;this.type=type;this.mimeType=mimeType;this.encoding=encoding;this.description=description;this.genre=genre;this.date=date;this.size=size;
this.duration=duration;this.ageRating=ageRating}MediaAsset.create=function(){return new MediaAsset};function AnnouncementEvent(type,time,message,imageURL,timeout){this.type=type;this.time=time;this.message=message;this.imageURL=imageURL;this.timeout=timeout}AnnouncementEvent.create=function(){return new AnnouncementEvent};function Announcement(event,appId,appName,appImage,appUrl){this.event=event;this.id=appId;this.name=appName;this.image=appImage;this.url=appUrl}Announcement.create=function(){return new Announcement};
this.State=State;this.Application=Application;this.Player=Player;this.channels=[];this.state=new State;this.state.settings.current.profile=new Profile("","");this.Channel=Channel;this.keymap=new KeyMap;this.MediaAsset=MediaAsset;this.AnnouncementEvent=AnnouncementEvent;this.Announcement=Announcement};